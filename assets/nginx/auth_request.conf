auth_request /auth/v1/clients/test/forward_auth

## Save the upstream metadata response headers
auth_request_set $user $upstream_http_remote_user;
auth_request_set $groups $upstream_http_remote_groups;
auth_request_set $name $upstream_http_remote_name;
auth_request_set $email $upstream_http_remote_email;

## Inject the metadata response headers
proxy_set_header Remote-User $user;
proxy_set_header Remote-Groups $groups;
proxy_set_header Remote-Email $email;
proxy_set_header Remote-Name $name;

## Set the $redirection_url to the Location header of the response
auth_request_set $redirection_url $upstream_http_location;

## Redirect to $redirection_url on HTTP 401
error_page 401 =302 $redirection_url;
