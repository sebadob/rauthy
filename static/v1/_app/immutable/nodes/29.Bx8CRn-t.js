import{n as Ut,a as s,t as c,d as st,e as pe}from"../chunks/DVyqXkF9.js";import{t as g,c as d,j as e,k as i,r as u,a5 as V,l as t,p as Ct,a2 as Ue,a1 as At,a6 as ve,f as B,a as Dt,s as l,a3 as Nt,a4 as we}from"../chunks/DXTz3Rbt.js";import{e as qt,r as Ft,h as Wt,s as U}from"../chunks/BLUcFBb0.js";import{i as _}from"../chunks/Dnzfvyee.js";import{e as Ot}from"../chunks/Dus-q-Em.js";import{s as K,b as Ht}from"../chunks/B28jQOFH.js";import{F as Bt,G as Gt,H as Vt,I as Kt,m as Jt,J as Qt,f as Xt,s as it,j as Yt,K as Zt,P as er,L as tr}from"../chunks/Cx6cA6Ki.js";import{B as be}from"../chunks/BaLU91-Z.js";import{W as rr}from"../chunks/Cg_cjOPk.js";import{I as ar,f as lt}from"../chunks/DxMCa-Hz.js";import{L as or}from"../chunks/TrxSD_Cs.js";import{p as Ce}from"../chunks/D54UoLP7.js";import{M as sr}from"../chunks/BdLPQyv5.js";import{C as ir}from"../chunks/DrM_mJzu.js";import{u as lr}from"../chunks/pXVVLMtZ.js";import{T as G}from"../chunks/DIOStUGY.js";import{u as q}from"../chunks/21dMcSbF.js";import{T as nr}from"../chunks/C-Rj8bXN.js";import{I as vr}from"../chunks/BFELTQEF.js";import{b as de}from"../chunks/DMieIo7a.js";import{u as nt}from"../chunks/D06dnomN.js";import{F as dr}from"../chunks/BkyS6Cp-.js";import{B as ur}from"../chunks/CcCkFGvD.js";import{R as cr}from"../chunks/B4SKEprN.js";var fr=Ut(`<svg fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125
            1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504
            1.125-1.125V9.75M8.25 21h8.25"></path></svg>`);function mr(te,I){let F=Ce(I,"opacity",3,.9),v=Ce(I,"width",3,"1.5rem"),$=Ce(I,"color",3,"currentColor");var k=fr();K(k,"stroke-width",2),g(()=>{K(k,"stroke",$()),K(k,"width",v()),K(k,"opacity",F())}),s(te,k)}var _r=c('<img alt="Client Logo" width="100%" height="100%">'),hr=c('<div class="logo svelte-1gwy16z"><!></div>');function gr(te,I){let F=i(!1),v=V(()=>I.updated?`/auth/v1/clients/${I.clientId}/logo?updated=${I.updated}`:`/auth/v1/clients/${I.clientId}/logo`);var $=hr(),k=d($);{var p=T=>{cr(T,{width:"100%"})},J=T=>{var w=_r();g(()=>K(w,"src",e(v))),qt("error",w,()=>t(F,!0)),Ft(w),s(T,w)};_(k,T=>{e(F)||I.updated===void 0?T(p):T(J,!1)})}u($),s(te,$)}var pr=c('<a class="home svelte-j0vmae" aria-label="Client Home Page"><!></a>'),wr=c('<div class="forgotten svelte-j0vmae"><!></div>'),br=c("<!> <!>",1),Pr=c('<div class="btn flex-col svelte-j0vmae"><!></div>'),Lr=c('<div class="btn flex-col svelte-j0vmae"><!></div>'),xr=c("<div><!></div> <!> <!>",1),Ir=c('<a class="reg svelte-j0vmae" target="_blank"> </a>'),Tr=c('<a class="reg svelte-j0vmae" href="/auth/v1/users/register" target="_blank"> </a>'),yr=c("<!> <!>",1),Rr=c('<div class="errMsg svelte-j0vmae"> </div>'),jr=c('<div class="success svelte-j0vmae"> </div>'),$r=c('<div class="btn flex-col svelte-j0vmae"><!></div>'),kr=c('<div class="providers flex-col svelte-j0vmae"><div class="providersSeparator svelte-j0vmae"><div class="separator svelte-j0vmae"></div> <div class="loginWith svelte-j0vmae"><div class="svelte-j0vmae"> </div></div></div> <!></div>'),zr=c('<div class="container svelte-j0vmae"><div class="head svelte-j0vmae"><!> <!></div> <div class="name svelte-j0vmae"><h2> </h2></div> <!> <!> <!> <!> <!> <!></div> <!> <!>',1),Er=c('<div class="outer svelte-j0vmae"><!></div>'),Sr=c("<!> <!> <!> <!> <!> <!> <!> <!>",1);function oa(te,I){Ct(I,!0);const F="18rem";let v=lr(),$=nt().get(),k=V(()=>$?"/auth/v1/dev/authorize":"/auth/v1/oidc/authorize"),p=q("client_id").get(),J=i(""),T=i(-1),w=i(Ue($?"/auth/v1":"")),Q=q("redirect_uri").get(),Pe=q("nonce").get(),Le=q("scope").get()?.split(" ")||[],xe=i(void 0),Ie=i(void 0),Te=q("state").get(),re=q("code_challenge").get(),z=q("code_challenge_method").get(),Ae=!1,ye=i(void 0),ue=i(Ue([])),ce=i(void 0),R=i(!1),f=i(""),ae=i(""),fe=i(""),C=i(!1),W=i(!1),me=i(!1),_e=i(!1),he=i(!1),O=i(!1),De=i(""),Re=i(!1),P=i(Ue(q("login_hint").get()||"")),E=i(""),je=i(""),Ne=V(()=>e(C)&&e(ye)!==e(P)&&!e(me));At(()=>{e(C)||e(xe)?.focus()}),ve(()=>{Ae&&p?.length&&ut()}),ve(()=>{e(he)&&setTimeout(()=>{t(he,!1),t(me,!1),t(_e,!1)},3e3)}),ve(()=>{e(Ie)?.focus()}),ve(()=>{if(e(ae)==="Refresh")Ae=!0;else if(e(ae)?.startsWith("MfaLogin ")){let r=e(ae).replace("MfaLogin ","");t(P,r,!0),t(ye,r,!0)}}),ve(()=>{$?vt():e(fe)&&it(e(fe))});async function vt(){let r=await de("/auth/v1/oidc/session");r.body?.csrf_token?it(r.body.csrf_token):console.error(r.error)}function dt(){t(f,""),t(me,!0),t(E,"")}async function ut(){if(!p){console.error("clientId is undefined");return}if(!Q){console.error("redirectUri is undefined");return}t(R,!0);const r={client_id:p,redirect_uri:Q,state:Te,nonce:Pe,scopes:Le};re&&z&&(z==="plain"||z==="S256")&&(r.code_challenge=re,r.code_challenge_method=z);let n=await de("/auth/v1/oidc/authorize/refresh",r);await qe(n)}async function ct(r,n){if(t(f,""),!p){console.error("clientId is undefined");return}if(!Q){console.error("redirectUri is undefined");return}t(R,!0);let L=await lt()||"";const x={email:e(P),pow:L,client_id:p,redirect_uri:Q,state:Te,nonce:Pe,scopes:Le};if(re&&z&&(z==="plain"||z==="S256")&&(x.code_challenge=re,x.code_challenge_method=z),e(C)&&e(P)!==e(ye)){if(!e(E)){t(f,v.authorize.passwordRequired,!0),t(R,!1);return}if(e(E).length>256){t(f,"max 256"),t(R,!1);return}x.password=e(E)}let y="/auth/v1/oidc/authorize";nt().get()&&(y="/auth/v1/dev/authorize");let oe=await de(y,x,"json","noRedirect");await qe(oe)}async function qe(r){if(t(R,!1),r.status===202){let n=r.headers.get("location");if(!n){console.error("location header missing");return}window.location.replace(n)}else if(r.status===200){t(f,"");let n=r.body;n&&"user_id"in n&&"code"in n?(t(je,n.user_id,!0),t(ce,{Login:n.code},!0)):console.error("did not receive a proper WebauthnLoginResponse after HTTP200")}else if(r.status===400)t(f,r.error?.message||"",!0);else if(r.status===406)t(f,v.authorize.clientForceMfa,!0),t(W,!0);else if(r.status===429){let n=r.headers.get("x-retry-not-before");if(!n){console.error("x-retry-not-before header missing");return}let L=Number.parseInt(n),x=Yt(L),y=L*1e3-new Date().getTime();t(O,!0),t(f,`${v.authorize.http429} ${x}`),t(P,""),t(E,""),t(C,!1),setTimeout(()=>{t(O,!1),t(f,"")},y)}else e(C)?(t(f,v.authorize.invalidCredentials,!0),t(_e,!0)):(t(C,!0),t(De,e(P),!0))}function ft(){e(C)&&e(De)!==e(P)&&(t(C,!1),t(E,""),t(f,""))}function mt(r){Zt(64,(n,{challenge:L,verifier:x})=>{n||(localStorage.setItem(er,x),_t(r,L))})}async function _t(r,n){if(t(P,""),t(E,""),!p){console.error("clientId is undefined");return}if(!Q){console.error("redirectUri is undefined");return}t(R,!0);let L=await lt()||"",x={email:e(P)||void 0,client_id:p,redirect_uri:Q,scopes:Le,state:Te,nonce:Pe,code_challenge:re,code_challenge_method:z,provider_id:r,pkce_challenge:n,pow:L},y=await de("/auth/v1/providers/login",x);if(t(R,!1),y.text){tr(y.text);let oe=y.headers.get("location");if(!oe){console.error("no location header set for provider login");return}window.location.href=oe}else t(f,y.error?.message||"Error",!0)}function ht(r){t(ce,void 0),t(f,r,!0)}function gt(r){r&&"loc"in r&&window.location.replace(r.loc)}async function pt(){let r={email:e(P)};e(w)&&(r.redirect_uri=encodeURI(e(w))),t(R,!0);let n=await de("/auth/v1/users/request_reset",r);n.error?t(f,n.error.message,!0):t(he,!0),t(R,!1)}var Fe=Sr();Wt(r=>{g(()=>Nt.title=`Login ${(e(J)||p)??""}`)});var We=B(Fe);G(We,{id:Bt,get value(){return e(ue)},set value(r){t(ue,r,!0)}});var Oe=l(We,2);G(Oe,{id:Gt,get value(){return e(J)},set value(r){t(J,r,!0)}});var He=l(Oe,2);G(He,{id:Vt,get value(){return e(w)},set value(r){t(w,r,!0)}});var Be=l(He,2);G(Be,{id:Kt,get value(){return e(T)},set value(r){t(T,r,!0)}});var Ge=l(Be,2);G(Ge,{id:Jt,get value(){return e(fe)},set value(r){t(fe,r,!0)}});var Ve=l(Ge,2);G(Ve,{id:Qt,get value(){return e(ae)},set value(r){t(ae,r,!0)}});var Ke=l(Ve,2);G(Ke,{id:Xt,get value(){return e(Re)},set value(r){t(Re,r,!0)}});var wt=l(Ke,2);sr(wt,{children:(r,n)=>{var L=Er(),x=d(L);ir(x,{children:(y,oe)=>{var Je=zr(),$e=B(Je),ke=d($e),Qe=d(ke);{var bt=a=>{const o=V(()=>e(T)>-1?e(T):void 0);gr(a,{clientId:p,get updated(){return e(o)}})};_(Qe,a=>{p&&a(bt)})}var Pt=l(Qe,2);{var Lt=a=>{var o=pr(),h=d(o);mr(h,{color:"hsla(var(--text) / .4)"}),u(o),g(()=>K(o,"href",e(w))),s(a,o)};_(Pt,a=>{e(w)&&a(Lt)})}u(ke);var ze=l(ke,2),Xe=d(ze),xt=d(Xe,!0);u(Xe),u(ze);var Ye=l(ze,2);{var It=a=>{rr(a,{get userId(){return e(je)},get purpose(){return e(ce)},onSuccess:gt,onError:ht})};_(Ye,a=>{e(ce)&&e(je)&&a(It)})}var Ze=l(Ye,2);{var Tt=a=>{var o=yr(),h=B(o);dr(h,{get action(){return e(k)},onSubmit:ct,children:(S,ie)=>{var A=xr(),M=B(A);let Y;var D=d(M);const j=V(()=>e(O)||e(W));ar(D,{typ:"email",name:"email",autocomplete:"email",get label(){return v.common.email},get placeholder(){return v.common.email},get errMsg(){return v.authorize.validEmail},get disabled(){return e(j)},onInput:ft,width:F,required:!0,get ref(){return e(xe)},set ref(b){t(xe,b,!0)},get value(){return e(P)},set value(b){t(P,b,!0)}}),u(M);var Z=l(M,2);{var Et=b=>{var le=br(),ge=B(le);const Ee=V(()=>e(O)||e(W));vr(ge,{name:"password",autocomplete:"current-password",get label(){return v.common.password},get placeholder(){return v.common.password},maxLength:256,get disabled(){return e(Ee)},width:F,required:!0,get ref(){return e(Ie)},set ref(m){t(Ie,m,!0)},get value(){return e(E)},set value(m){t(E,m,!0)}});var Se=l(ge,2);{var N=m=>{var H=wr(),ne=d(H);be(ne,{invisible:!0,onclick:dt,children:(Me,ee)=>{we();var ot=pe();g(()=>U(ot,v.authorize.passwordForgotten)),s(Me,ot)},$$slots:{default:!0}}),u(H),s(m,H)};_(Se,m=>{e(_e)&&!e(O)&&m(N)})}s(b,le)};_(Z,b=>{e(Ne)&&b(Et)})}var St=l(Z,2);{var Mt=b=>{var le=st(),ge=B(le);{var Ee=N=>{var m=Pr(),H=d(m);be(H,{onclick:pt,children:(ne,Me)=>{we();var ee=pe();g(()=>U(ee,v.authorize.passwordRequest)),s(ne,ee)},$$slots:{default:!0}}),u(m),s(N,m)},Se=N=>{var m=Lr(),H=d(m);be(H,{type:"submit",get isLoading(){return e(R)},children:(ne,Me)=>{we();var ee=pe();g(()=>U(ee,v.authorize.login)),s(ne,ee)},$$slots:{default:!0}}),u(m),s(N,m)};_(ge,N=>{e(me)?N(Ee):N(Se,!1)})}s(b,le)};_(St,b=>{!e(O)&&!e(W)&&b(Mt)})}g(b=>Y=Ht(M,1,"svelte-j0vmae",null,Y,b),[()=>({emailMinHeight:!e(Ne)})]),s(S,A)},$$slots:{default:!0}});var X=l(h,2);{var se=S=>{var ie=st(),A=B(ie);{var M=D=>{var j=Ir(),Z=d(j,!0);u(j),g(()=>{K(j,"href",`/auth/v1/users/register?redirect_uri=${e(w)??""}`),U(Z,v.authorize.signUp)}),s(D,j)},Y=D=>{var j=Tr(),Z=d(j,!0);u(j),g(()=>U(Z,v.authorize.signUp)),s(D,j)};_(A,D=>{e(w)?D(M):D(Y,!1)})}s(S,ie)};_(X,S=>{e(Re)&&!e(_e)&&!e(O)&&S(se)})}s(a,o)};_(Ze,a=>{e(W)||a(Tt)})}var et=l(Ze,2);{var yt=a=>{var o=Rr(),h=d(o,!0);u(o),g(()=>U(h,e(f))),s(a,o)};_(et,a=>{e(f)&&a(yt)})}var tt=l(et,2);{var Rt=a=>{var o=jr(),h=d(o,!0);u(o),g(()=>U(h,v.authorize.emailSentMsg)),s(a,o)};_(tt,a=>{e(he)&&a(Rt)})}var rt=l(tt,2);{var jt=a=>{var o=$r(),h=d(o);be(h,{onclick:()=>window.location.href="/auth/v1/account",children:(X,se)=>{we();var S=pe("Account");s(X,S)},$$slots:{default:!0}}),u(o),s(a,o)};_(rt,a=>{e(W)&&a(jt)})}var $t=l(rt,2);{var kt=a=>{var o=kr(),h=d(o),X=l(d(h),2),se=d(X),S=d(se,!0);u(se),u(X),u(h);var ie=l(h,2);Ot(ie,17,()=>e(ue),A=>A.id,(A,M)=>{const Y=V(()=>`Login: ${e(M).name}`);ur(A,{get ariaLabel(){return e(Y)},get provider(){return e(M)},onclick:mt})}),u(o),g(()=>U(S,v.authorize.orLoginWith)),s(a,o)};_($t,a=>{!e(W)&&e(ue).length>0&&a(kt)})}u($e);var at=l($e,2);nr(at,{absolute:!0});var zt=l(at,2);or(zt,{absolute:!0}),g(()=>U(xt,e(J)||p)),s(y,Je)}}),u(L),s(r,L)}}),s(te,Fe),Dt()}export{oa as component};
