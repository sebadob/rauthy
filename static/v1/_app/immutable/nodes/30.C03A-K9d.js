import{d as g,a as p,t as C}from"../chunks/DVyqXkF9.js";import{p as S,a1 as k,f as T,a as E,a3 as R,l as n,k as $,j as l,c as j,r as y,t as I}from"../chunks/DXTz3Rbt.js";import{h as b,s as x}from"../chunks/BLUcFBb0.js";import{i as U}from"../chunks/Dnzfvyee.js";import{C as A,c as D,s as P,d as z,R as F,e as L}from"../chunks/Cx6cA6Ki.js";import{u as f}from"../chunks/21dMcSbF.js";var V=C('<div class="err"> </div>');function q(m,u){S(u,!0);let a=$(""),_=f("code"),h=f("state");k(async()=>{let t=_.get();if(!t){console.error("no `code` given");return}const e=new URLSearchParams;e.append("grant_type","authorization_code"),e.append("code",t),e.append("redirect_uri",`${window.location.origin}/auth/v1/oidc/callback`),e.append("client_id",A),e.append("code_verifier",D());let o=await(await fetch("/auth/v1/oidc/token",{method:"POST",headers:{"Content-type":"application/x-www-form-urlencoded",Accept:"application/json"},body:e})).json();if(o.error)n(a,o.error.toString(),!0);else if(o.access_token){let i=await(await fetch("/auth/v1/oidc/sessioninfo/xsrf",{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${o.access_token}`}})).json();if(i.csrf_token)P(i.csrf_token);else{n(a,i.toString(),!0);return}z();let s=window.location.origin+F,r=h.get();r&&(r==="account"?s=window.location.origin+L:r.startsWith("device")&&(s=`${window.location.origin}/auth/v1/${r}`)),window.location.replace(s)}else n(a,"")});var c=g();b(t=>{R.title="Callback"});var w=T(c);{var v=t=>{var e=V(),d=j(e,!0);y(e),I(()=>x(d,l(a))),p(t,e)};U(w,t=>{l(a)&&t(v)})}p(m,c),E()}export{q as component};
