import{t as P,a as d,e as ye,d as Ve}from"../chunks/DVyqXkF9.js";import{p as Te,c as a,s as v,j as e,a5 as ie,r as t,t as A,a as Ce,a4 as we,k as R,l as o,f as ke,a2 as We,a1 as Ze,a6 as qe,a3 as tr}from"../chunks/DXTz3Rbt.js";import{s as u,d as Ct,o as rr,e as st,h as ar}from"../chunks/BLUcFBb0.js";import{i as w}from"../chunks/Dnzfvyee.js";import{a as et,b as q,c as B,s as he,r as sr}from"../chunks/B28jQOFH.js";import{b as vr}from"../chunks/C7VkQHIl.js";import{p as ve}from"../chunks/D54UoLP7.js";import{j as Qe,N as nt,K as or,P as nr,L as ir,x as lr,O as bt,F as ur,r as dr}from"../chunks/Cx6cA6Ki.js";import{e as Dt}from"../chunks/Dus-q-Em.js";import{h as Mt}from"../chunks/CP6_I6cz.js";import{C as Xe}from"../chunks/CdgZ0Q70.js";import{B as xe,t as Ne,f as Re,s as Lt}from"../chunks/BaLU91-Z.js";import{M as cr}from"../chunks/Dc4s6GFH.js";import{u as Ae}from"../chunks/pXVVLMtZ.js";import{c as Nt,b as it,d as ut,f as Ue}from"../chunks/QS8tP13U.js";import{B as fr}from"../chunks/CcCkFGvD.js";import{U as _r,a as mr,D as At}from"../chunks/DT763D64.js";import{f as pr,I as Me}from"../chunks/DVvDmFQc.js";import{F as hr}from"../chunks/BHicDA9d.js";import{b as lt,h as gr,i as yt,j as wr}from"../chunks/DzmDou2k.js";import{I as dt}from"../chunks/COZs6rVX.js";import{I as br}from"../chunks/AGQ0LC6s.js";import{u as ct}from"../chunks/B8seyMn8.js";import{w as yr}from"../chunks/BNL49os7.js";import{W as Wt}from"../chunks/CqGjWW6k.js";import{P as xr}from"../chunks/DTccziEZ.js";import{I as vt}from"../chunks/BFELTQEF.js";import{s as kr}from"../chunks/BPSUy9kl.js";import{a as Pr,c as Ir}from"../chunks/B3Y-rhQz.js";import{A as Er}from"../chunks/n3DGaXnr.js";import{b as Tr}from"../chunks/BAilAnr9.js";import{T as Cr}from"../chunks/D83BWmtm.js";import{u as Dr}from"../chunks/C7g8-Uli.js";import{T as xt}from"../chunks/Uvg4PFWU.js";import{I as Mr}from"../chunks/B_w8eXGz.js";import{M as Lr}from"../chunks/BdLPQyv5.js";import{C as Nr}from"../chunks/DrM_mJzu.js";import{T as Ar}from"../chunks/C-Rj8bXN.js";import{L as Wr}from"../chunks/jffJzMFF.js";var Rr=P('<div class="link-err value svelte-1tea8v4"> </div>'),zr=P('<div class="fed-btn svelte-1tea8v4"><!> <!></div>'),Sr=P('<h3> </h3> <p> </p> <div class="providers svelte-1tea8v4"></div>',1),Vr=P("<!> <!>",1),qr=P('<div><div> </div> <span class="value svelte-1tea8v4"> </span></div>'),Ur=P('<div><div> </div> <span class="value svelte-1tea8v4"> </span></div>'),Fr=P('<div><div>WebID:</div> <span class="value svelte-1tea8v4"><a target="_blank"><!></a></span></div>'),Br=P('<div><div><div></div> <!></div> <div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <div><div> </div> <div><div class="value svelte-1tea8v4"> </div> <!></div></div> <div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <div><div> </div> <!></div> <div><div> </div> <!></div> <div><div> </div> <!></div> <!> <div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <div><div> </div> <span class="value svelte-1tea8v4"> </span></div> <!> <!></div>');function ot(re,i){Te(i,!0);let r=ve(i,"user",15),s=Ae(),I=R(!1),n=R(!1),T=ie(()=>r().account_type?.startsWith("federated")),m=ie(()=>e(T)?`${r().account_type}: ${i.authProvider?.name||""}`:r().account_type),l=ie(()=>i.viewModePhone?"rowPhone":"row"),b=ie(()=>i.viewModePhone?"labelPhone":"label"),x=R(!1),c=ie(()=>{let V=r().given_name[0];return r().family_name&&r().family_name.length>0&&(V+=r().family_name[0]),V});function C(V){or(64,(ae,{challenge:ne,verifier:be})=>{ae||(localStorage.setItem(nr,be),K(V,ne))})}async function K(V,ae){o(x,!0);let ne=await pr()||"",be={email:r().email,pow:ne,client_id:"rauthy",redirect_uri:window.location.href,provider_id:V,pkce_challenge:ae},_e=await it(`/auth/v1/providers/${V}/link`,be);if(o(x,!1),_e.text){ir(_e.text);let ge=_e.headers.get("location");ge&&(window.location.href=ge)}else console.error(_e.error)}async function Y(){let V=await Nt("/auth/v1/providers/link");V.body?r(V.body):(console.error(V.error),o(I,!0))}var te=Br(),X=a(te);et(X,"",{},{margin:".5rem 0"});var D=a(X),Z=v(D,2);_r(Z,{get fallbackCharacters(){return e(c)},get userId(){return r().id},size:"large",get pictureId(){return r().picture_id},set pictureId(V){r(r().picture_id=V,!0)}}),t(X);var se=v(X,2),f=a(se),U=a(f,!0);t(f);var $=v(f,2),ee=a($,!0);t($),t(se);var S=v(se,2),E=a(S),p=a(E,!0);t(E);var y=v(E,2),h=a(y,!0);t(y),t(S);var G=v(S,2),F=a(G),me=a(F,!0);t(F);var g=v(F,2),M=a(g,!0);t(g),t(G);var _=v(G,2),L=a(_),O=a(L);t(L);var J=v(L,2),Q=a(J,!0);t(J),t(_);var ue=v(_,2),oe=a(ue),de=a(oe,!0);t(oe);var ce=v(oe,2),z=a(ce),k=a(z,!0);t(z);var W=v(z,2);{var j=V=>{var ae=zr(),ne=a(ae);xe(ne,{get ariaLabel(){return s.account.providerUnlink},level:3,onclick:Y,children:(ge,Ee)=>{we();var De=ye();A(()=>u(De,s.account.providerUnlink)),d(ge,De)},$$slots:{default:!0}});var be=v(ne,2);{var _e=ge=>{var Ee=Rr(),De=a(Ee,!0);t(Ee),A(()=>u(De,s.account.providerUnlinkDesc)),d(ge,Ee)};w(be,ge=>{e(I)&&ge(_e)})}t(ae),d(V,ae)},fe=(V,ae)=>{{var ne=be=>{var _e=Vr(),ge=ke(_e);xe(ge,{level:2,onclick:()=>o(n,!0),children:(De,Qt)=>{we();var Se=ye();A(()=>u(Se,s.account.providerLink)),d(De,Se)},$$slots:{default:!0}});var Ee=v(ge,2);cr(Ee,{get showModal(){return e(n)},set showModal(De){o(n,De,!0)},children:(De,Qt)=>{var Se=Sr(),tt=ke(Se),Xt=a(tt,!0);t(tt);var rt=v(tt,2),Zt=a(rt,!0);t(rt);var gt=v(rt,2);Dt(gt,21,()=>i.providers,at=>at.id,(at,wt)=>{const er=ie(()=>`${s.account.providerLink}: ${e(wt).name}`);fr(at,{get ariaLabel(){return e(er)},get provider(){return e(wt)},onclick:C,get isLoading(){return e(x)}})}),t(gt),A(()=>{u(Xt,s.account.providerLink),u(Zt,s.account.providerLinkDesc)}),d(De,Se)},$$slots:{default:!0}}),d(be,_e)};w(V,be=>{i.providers.length>0&&be(ne)},ae)}};w(W,V=>{e(T)?V(j):V(fe,!1)})}t(ce),t(ue);var H=v(ue,2),N=a(H),pe=a(N,!0);t(N);var le=v(N,2),Ie=a(le,!0);t(le),t(H);var Pe=v(H,2),Le=a(Pe),ft=a(Le,!0);t(Le);var ze=v(Le,2),Rt=a(ze,!0);t(ze),t(Pe);var Fe=v(Pe,2),Be=a(Fe),zt=a(Be,!0);t(Be);var St=v(Be,2);const Vt=ie(()=>!!r().webauthn_user_id);Xe(St,{get checked(){return e(Vt)}}),t(Fe);var Oe=v(Fe,2),Ke=a(Oe),qt=a(Ke,!0);t(Ke);var Ut=v(Ke,2);Xe(Ut,{get checked(){return r().enabled}}),t(Oe);var $e=v(Oe,2),je=a($e),Ft=a(je,!0);t(je);var Bt=v(je,2);Xe(Bt,{get checked(){return r().email_verified}}),t($e);var _t=v($e,2);{var Ot=V=>{var ae=qr(),ne=a(ae),be=a(ne,!0);t(ne);var _e=v(ne,2),ge=a(_e,!0);t(_e),t(ae),A(Ee=>{q(ae,1,B(e(l)),"svelte-1tea8v4"),q(ne,1,B(e(b)),"svelte-1tea8v4"),u(be,s.account.lastLogin),u(ge,Ee)},[()=>Qe(r().last_login)]),d(V,ae)};w(_t,V=>{r().last_login&&V(Ot)})}var He=v(_t,2),Ye=a(He),Kt=a(Ye,!0);t(Ye);var mt=v(Ye,2),$t=a(mt,!0);t(mt),t(He);var Ge=v(He,2),Je=a(Ge),jt=a(Je,!0);t(Je);var pt=v(Je,2),Ht=a(pt,!0);t(pt),t(Ge);var ht=v(Ge,2);{var Yt=V=>{var ae=Ur(),ne=a(ae),be=a(ne,!0);t(ne);var _e=v(ne,2),ge=a(_e,!0);t(_e),t(ae),A(Ee=>{q(ae,1,B(e(l)),"svelte-1tea8v4"),q(ne,1,B(e(b)),"svelte-1tea8v4"),u(be,s.account.userExpiry),u(ge,Ee)},[()=>Qe(r().user_expires)]),d(V,ae)};w(ht,V=>{r().user_expires&&V(Yt)})}var Gt=v(ht,2);{var Jt=V=>{var ae=Fr(),ne=a(ae),be=v(ne,2),_e=a(be),ge=a(_e);Mt(ge,()=>nt(r().id).replace("/auth/","/auth/<wbr/>")),t(_e),t(be),t(ae),A(Ee=>{q(ae,1,B(e(l)),"svelte-1tea8v4"),q(ne,1,B(e(b)),"svelte-1tea8v4"),he(_e,"href",Ee)},[()=>nt(r().id)]),d(V,ae)};w(Gt,V=>{i.webIdData&&V(Jt)})}t(te),A((V,ae)=>{q(X,1,B(e(l)),"svelte-1tea8v4"),q(D,1,B(e(b)),"svelte-1tea8v4"),q(se,1,B(e(l)),"svelte-1tea8v4"),q(f,1,B(e(b)),"svelte-1tea8v4"),u(U,s.common.email),u(ee,r().email),q(S,1,B(e(l)),"svelte-1tea8v4"),q(E,1,B(e(b)),"svelte-1tea8v4"),u(p,s.account.givenName),u(h,r().given_name),q(G,1,B(e(l)),"svelte-1tea8v4"),q(F,1,B(e(b)),"svelte-1tea8v4"),u(me,s.account.familyName),u(M,r().family_name),q(_,1,B(e(l)),"svelte-1tea8v4"),q(L,1,B(e(b)),"svelte-1tea8v4"),u(O,`${s.account.user??""} ID`),u(Q,r().id),q(ue,1,B(e(l)),"svelte-1tea8v4"),q(oe,1,B(e(b)),"svelte-1tea8v4"),u(de,s.account.accType),u(k,e(m)||""),q(H,1,B(e(l)),"svelte-1tea8v4"),q(N,1,B(e(b)),"svelte-1tea8v4"),u(pe,s.account.roles),u(Ie,r().roles||"None"),q(Pe,1,B(e(l)),"svelte-1tea8v4"),q(Le,1,B(e(b)),"svelte-1tea8v4"),u(ft,s.account.groups),u(Rt,r().groups||"None"),q(Fe,1,B(e(l)),"svelte-1tea8v4"),q(Be,1,B(e(b)),"svelte-1tea8v4"),u(zt,s.account.mfaActivated),q(Oe,1,B(e(l)),"svelte-1tea8v4"),q(Ke,1,B(e(b)),"svelte-1tea8v4"),u(qt,s.account.userEnabled),q($e,1,B(e(l)),"svelte-1tea8v4"),q(je,1,B(e(b)),"svelte-1tea8v4"),u(Ft,s.account.emailVerified),q(He,1,B(e(l)),"svelte-1tea8v4"),q(Ye,1,B(e(b)),"svelte-1tea8v4"),u(Kt,s.account.passwordExpiry),u($t,V),q(Ge,1,B(e(l)),"svelte-1tea8v4"),q(Je,1,B(e(b)),"svelte-1tea8v4"),u(jt,s.account.userCreated),u(Ht,ae)},[()=>r().password_expires&&Qe(r().password_expires)||s.common.never,()=>Qe(r().created_at)]),d(re,te),Ce()}var Or=P('<div class="success svelte-4ogr3z"><!></div>'),Kr=P("<p> </p>"),$r=P('<div class="err svelte-4ogr3z"> </div>'),jr=P('<div class="formInner svelte-4ogr3z"><div><!> <!> <!> <!></div> <div><!> <!> <!> <!> <!></div></div> <div class="bottom svelte-4ogr3z"><div><!></div> <!></div> <!>',1),Hr=P('<div class="container svelte-4ogr3z"><!></div>');function kt(re,i){Te(i,!0);let r=ve(i,"user",15);r().user_values?.birthdate||r(r().user_values.birthdate="",!0);let s=Ae(),I=R(""),n=R(!1),T=R(!1);async function m(c,C){const K=C.get("email"),Y=C.get("family_name")||void 0,te=C.get("given_name")||void 0,X=C.get("birthdate")||void 0,D=C.get("phone")?.replaceAll(" ","")||void 0,Z=C.get("street")||void 0,se=C.get("zip")||void 0,f=se?Number.parseInt(se):void 0,U=C.get("city")||void 0,$=C.get("country")||void 0;let ee={email:K,family_name:Y,given_name:te};(X||D||Z||f||U||$)&&(ee.user_values={birthdate:X,phone:D,street:Z,zip:f,city:U,country:$});let S=await ut(`/auth/v1/users/${r().id}/self`,ee);if(S.body){o(n,!0),S.body.user_values?.birthdate||(S.body.user_values.birthdate=""),r(S.body);let E=3e3;S.status===202&&(o(T,!0),E=3e4),setTimeout(()=>{o(n,!1)},E)}else S.error&&(console.error(S.error),o(I,S.error.message,!0))}var l=Hr(),b=a(l);const x=ie(()=>`/auth/v1/users/${r().id}/self`);hr(b,{get action(){return e(x)},onSubmit:m,children:(c,C)=>{var K=jr(),Y=ke(K),te=a(Y),X=a(te);Me(X,{typ:"email",name:"email",get label(){return s.common.email},get placeholder(){return s.common.email},get value(){return r().email},required:!0});var D=v(X,2);Me(D,{name:"given_name",autocomplete:"given-name",get label(){return s.account.givenName},get placeholder(){return s.account.givenName},get value(){return r().given_name},required:!0,maxLength:32,pattern:lt});var Z=v(D,2);Me(Z,{name:"family_name",autocomplete:"family-name",get label(){return s.account.familyName},get placeholder(){return s.account.familyName},get value(){return r().family_name},maxLength:32,pattern:lt});var se=v(Z,2);br(se,{name:"birthdate",get label(){return s.account.birthdate},withDelete:!0,get value(){return r().user_values.birthdate},set value(_){r(r().user_values.birthdate=_,!0)}}),t(te);var f=v(te,2),U=a(f);Me(U,{name:"street",autocomplete:"street-address",get label(){return s.account.street},get placeholder(){return s.account.street},get value(){return r().user_values.street},maxLength:48,pattern:gr});var $=v(U,2);Me($,{typ:"number",name:"zip",autocomplete:"postal-code",get label(){return s.account.zip},get placeholder(){return s.account.zip},get value(){return r().user_values.zip},min:"1000",max:"9999999"});var ee=v($,2);Me(ee,{name:"city",autocomplete:"address-level2",get label(){return s.account.city},get placeholder(){return s.account.city},get value(){return r().user_values.city},maxLength:48,pattern:yt});var S=v(ee,2);Me(S,{name:"country",autocomplete:"country",get label(){return s.account.country},get placeholder(){return s.account.country},get value(){return r().user_values.country},maxLength:48,pattern:yt});var E=v(S,2);Me(E,{name:"phone",autocomplete:"tel",get label(){return s.account.phone},get placeholder(){return s.account.phone},get value(){return r().user_values.phone},maxLength:32,pattern:wr}),t(f),t(Y);var p=v(Y,2),y=a(p),h=a(y);xe(h,{type:"submit",children:(_,L)=>{we();var O=ye();A(()=>u(O,s.common.save)),d(_,O)},$$slots:{default:!0}}),t(y);var G=v(y,2);{var F=_=>{var L=Or(),O=a(L);dt(O,{}),t(L),Ne(3,L,()=>Re),d(_,L)};w(G,_=>{e(n)&&_(F)})}t(p);var me=v(p,2);{var g=_=>{var L=Kr(),O=a(L,!0);t(L),A(()=>u(O,s.account.emailUpdateConfirm)),d(_,L)},M=(_,L)=>{{var O=J=>{var Q=$r(),ue=a(Q,!0);t(Q),A(()=>u(ue,e(I))),Ne(3,Q,()=>Re),d(J,Q)};w(_,J=>{e(I)&&J(O)},L)}};w(me,_=>{e(T)?_(g):_(M,!1)})}d(c,K)},$$slots:{default:!0}}),t(l),d(re,l),Ce()}var Yr=P('<div class="err svelte-16mlupu"><b>Your browser does not support Webauthn credentials and must be updated.</b></div>'),Gr=P('<!> <div class="regBtns svelte-16mlupu"><!> <!></div>',1),Jr=P('<div class="regNewBtn svelte-16mlupu"><!></div>'),Qr=P('<div class="keysHeader svelte-16mlupu"> </div>'),Xr=P('<div class="button svelte-16mlupu"><!></div>'),Zr=P('<!> <p class="svelte-16mlupu"> <br><br> </p> <!> <!> <div class="keysContainer svelte-16mlupu"></div> <!> <div> </div>',1),ea=P('<div class="container svelte-16mlupu"><!></div>');function Pt(re,i){Te(i,!0);const r="credentials"in navigator;let s=Ae(),I=ct("account"),n=ie(()=>I.get()?.user_id),T=R(void 0),m=R(!1),l=R(""),b=R(!1),x=R(i.user.account_type==="password"),c=R(void 0),C=R(""),K=R(!1),Y=R(We([]));Ze(()=>{X()}),qe(()=>{e(Y).length>0&&i.user.account_type==="passkey"&&o(x,e(Y).length>1)}),qe(()=>{e(T)?.focus()});function te(){o(m,!1),o(l,"")}async function X(){let E=await Ue(`/auth/v1/users/${I.get()?.user_id}/webauthn`);E.body?o(Y,E.body,!0):console.error(E.error)}async function D(){if(te(),e(K)||!e(n))return;if(e(C).length<1){o(m,!0),o(l,s.mfa.passkeyNameErr,!0);return}let E=await yr(e(n),e(C),s.authorize.invalidKeyUsed,s.authorize.requestExpired);E.error?(o(m,!0),o(l,`${s.mfa.errorReg} - ${E.error}`)):(o(b,!1),o(C,""),await X())}async function Z(E){let p=await Nt(`/auth/v1/users/${i.user.id}/webauthn/delete/${E}`);p.status===200?await X():o(l,p.error?.message||"Error",!0)}function se(E){o(c,void 0),o(m,!0),o(l,E,!0),setTimeout(()=>{o(m,!1),o(l,"")},5e3)}function f(E){o(c,void 0),o(l,s.mfa.testSuccess,!0),setTimeout(()=>{o(l,"")},3e3)}var U=ea(),$=a(U);{var ee=E=>{var p=Yr();d(E,p)},S=E=>{var p=Zr(),y=ke(p);{var h=z=>{Wt(z,{get userId(){return i.user.id},get purpose(){return e(c)},onSuccess:f,onError:se})};w(y,z=>{e(c)&&z(h)})}var G=v(y,2),F=a(G),me=v(F,3);t(G);var g=v(G,2);{var M=z=>{var k=Gr(),W=ke(k);Me(W,{autocomplete:"off",get label(){return s.mfa.passkeyName},get placeholder(){return s.mfa.passkeyName},maxLength:32,pattern:lt,onEnter:D,get ref(){return e(T)},set ref(N){o(T,N,!0)},get value(){return e(C)},set value(N){o(C,N,!0)},get isError(){return e(K)},set isError(N){o(K,N,!0)}});var j=v(W,2),fe=a(j);xe(fe,{onclick:D,children:(N,pe)=>{we();var le=ye();A(()=>u(le,s.mfa.register)),d(N,le)},$$slots:{default:!0}});var H=v(fe,2);xe(H,{level:3,onclick:()=>o(b,!1),children:(N,pe)=>{we();var le=ye();A(()=>u(le,s.common.cancel)),d(N,le)},$$slots:{default:!0}}),t(j),d(z,k)},_=z=>{var k=Jr(),W=a(k);const j=ie(()=>e(Y).length===0?1:2);xe(W,{get level(){return e(j)},onclick:()=>o(b,!0),children:(fe,H)=>{we();var N=ye();A(()=>u(N,s.mfa.registerNew)),d(fe,N)},$$slots:{default:!0}}),t(k),d(z,k)};w(g,z=>{e(b)?z(M):z(_,!1)})}var L=v(g,2);{var O=z=>{var k=Qr(),W=a(k,!0);t(k),A(()=>u(W,s.mfa.registerdKeys)),d(z,k)};w(L,z=>{e(Y).length>0&&z(O)})}var J=v(L,2);Dt(J,21,()=>e(Y),z=>z.name,(z,k)=>{mr(z,{get passkey(){return e(k)},get showDelete(){return e(x)},onDelete:Z})}),t(J);var Q=v(J,2);{var ue=z=>{var k=Xr(),W=a(k);xe(W,{onclick:()=>o(c,"Test"),children:(j,fe)=>{we();var H=ye();A(()=>u(H,s.mfa.test)),d(j,H)},$$slots:{default:!0}}),t(k),d(z,k)};w(Q,z=>{e(Y).length>0&&z(ue)})}var oe=v(Q,2);let de;var ce=a(oe,!0);t(oe),A(z=>{u(F,`${s.mfa.p1??""} `),u(me,` ${s.mfa.p2??""}`),de=q(oe,1,"svelte-16mlupu",null,de,z),u(ce,e(l))},[()=>({success:!e(m),err:e(m)})]),d(E,p)};w($,E=>{r?E(S,!1):E(ee)})}t(U),d(re,U),Ce()}var ta=P('<div class="container svelte-ue7bk2"><!> <!> <!> <!> <div class="btn svelte-ue7bk2"><!></div> <div class="err svelte-ue7bk2"> </div></div>');function ra(re,i){Te(i,!0);let r=ve(i,"passwords",15),s=ve(i,"hideCurrentPassword",3,!1),I=ve(i,"isValid",15),n=Ae();I(C);let T=R(!1),m=R(""),l=R(void 0),b=ie(()=>r().new?.length>6&&r().new===r().newConfirm),x=R(void 0),c=R(void 0);Ze(async()=>{let D=await Ue("/auth/v1/password_policy");D.body?o(l,D.body,!0):console.error(D.error)});function C(){return o(m,""),!s()&&!r().current?(o(m,n.account.passwordCurrReq,!0),!1):r().new?r().newConfirm?e(T)?r().new.length>256?(o(m,"max 256"),!1):r().new!==r().newConfirm?(o(m,n.account.passwordNoMatch,!0),!1):!0:(o(m,n.account.passwordPolicyFollow,!0),!1):(o(m,n.account.passwordNewReq,!0),!1):(o(m,n.account.passwordNewReq,!0),!1)}function K(){if(o(m,""),e(l)){let D=lr(e(l));r(r().new=D,!0),r(r().newConfirm=D,!0)}requestAnimationFrame(()=>{e(x)?.(),e(c)?.()})}var Y=Ve(),te=ke(Y);{var X=D=>{var Z=ta(),se=a(Z);xr(se,{get policy(){return e(l)},get password(){return r().new},get accepted(){return e(T)},set accepted(h){o(T,h,!0)}});var f=v(se,2);{var U=h=>{vt(h,{autocomplete:"current-password",get label(){return n.account.passwordCurr},get placeholder(){return n.account.passwordCurr},onInput:C,get width(){return i.inputWidth},get value(){return r().current},set value(G){r(r().current=G,!0)}})};w(f,h=>{s()||h(U)})}var $=v(f,2);vt($,{autocomplete:"new-password",get label(){return n.account.passwordNew},get placeholder(){return n.account.passwordNew},onInput:C,get showCopy(){return e(b)},get width(){return i.inputWidth},get value(){return r().new},set value(h){r(r().new=h,!0)},get reportValidity(){return e(x)},set reportValidity(h){o(x,h,!0)}});var ee=v($,2);vt(ee,{autocomplete:"new-password",get label(){return n.account.passwordConfirm},get placeholder(){return n.account.passwordConfirm},onInput:C,get showCopy(){return e(b)},get width(){return i.inputWidth},get value(){return r().newConfirm},set value(h){r(r().newConfirm=h,!0)},get reportValidity(){return e(c)},set reportValidity(h){o(c,h,!0)}});var S=v(ee,2),E=a(S);xe(E,{onclick:K,level:2,children:(h,G)=>{we();var F=ye();A(()=>u(F,n.account.generateRandom)),d(h,F)},$$slots:{default:!0}}),t(S);var p=v(S,2),y=a(p,!0);t(p),t(Z),A(()=>u(y,e(m))),d(D,Z)};w(te,D=>{e(l)&&D(X)})}return d(re,Y),Ce({isPwdValid:C})}var aa=P('<div class="m-05 svelte-1h4zvzu"><p> </p> <p><b> </b></p> <div></div> <p> </p> <!></div>'),sa=P("<p> </p> <p> </p> <p> </p> <div><!></div>",1),va=P('<div class="success svelte-1h4zvzu"><!></div>'),oa=P('<div class="err"> </div>'),na=P('<div class="cancel"><!></div>'),ia=P('<div class="convertPasskey svelte-1h4zvzu"><h3> </h3> <p> </p> <!></div>'),la=P('<div><!> <div class="save svelte-1h4zvzu"><!> <!></div></div> <!>',1),ua=P('<div class="container svelte-1h4zvzu"><!> <!> <!> <!></div>');function It(re,i){Te(i,!0);let r=ve(i,"user",15),s=Ae(),I=ie(()=>i.viewModePhone?"calc(100vw - 1.5rem)":"300px"),n=R(We(r().account_type)),T=R(We([])),m=R(void 0),l=R(!1),b=R(!1),x=R(""),c=R(!1),C=R(void 0),K=R(We({current:"",new:"",newConfirm:""})),Y=ie(()=>e(T).filter(g=>g.user_verified).length>0);Ze(()=>{te()});async function te(){let g=await Ue(`/auth/v1/users/${r().id}/webauthn`);g.body?o(T,g.body,!0):console.error("error fetching passkeys: "+g.error)}async function X(){let g=await it(`/auth/v1/users/${r().id}/self/convert_passkey`);g.error?console.error("error fetching passkeys: "+g.error):window.location.reload()}async function D(){o(x,""),e(T).length>0?await Z():await se()}async function Z(){if(!e(m)?.()){o(x,s.common.invalidInput,!0);return}o(C,"PasswordNew")}async function se(g){if(!e(m)?.()){o(x,s.common.invalidInput,!0);return}o(b,!0);let M={password_new:e(K).new};g?M.mfa_code=g:M.password_current=e(K).current;let _=await ut(`/auth/v1/users/${r().id}/self`,M);_.body?(o(c,!0),o(K,{current:"",new:"",newConfirm:""},!0),r(_.body),o(n,_.body.account_type,!0),setTimeout(()=>{o(c,!1),o(l,!1)},3e3)):o(x,_.error?.message||"Error",!0),o(b,!1)}function f(g){o(C,void 0),o(x,g,!0),setTimeout(()=>{o(x,"")},5e3)}function U(g){o(C,void 0),g&&"code"in g&&se(g.code)}async function $(){let g={email:r().email},M=await it("/auth/v1/users/request_reset",g);M.error?o(x,M.error.message,!0):o(c,!0)}var ee=ua(),S=a(ee);{var E=g=>{Wt(g,{get userId(){return r().id},get purpose(){return e(C)},onSuccess:U,onError:f})};w(S,g=>{e(C)&&g(E)})}var p=v(S,2);{var y=g=>{var M=aa(),_=a(M),L=a(_,!0);t(_);var O=v(_,2),J=a(O),Q=a(J,!0);t(J),t(O);var ue=v(O,2);et(ue,"",{},{height:".3rem"});var oe=v(ue,2),de=a(oe,!0);t(oe);var ce=v(oe,2);{var z=W=>{Xe(W,{checked:!0})},k=W=>{xe(W,{level:2,onclick:$,children:(j,fe)=>{we();var H=ye();A(()=>u(H,s.account.passwordReset)),d(j,H)},$$slots:{default:!0}})};w(ce,W=>{e(c)?W(z):W(k,!1)})}t(M),A(()=>{u(L,s.account.federatedConvertPassword1),u(Q,i.authProvider?.name||"UNKNOWN"),u(de,s.account.federatedConvertPassword2)}),d(g,M)};w(p,g=>{e(n)==="federated"&&g(y)})}var h=v(p,2);{var G=g=>{var M=sa(),_=ke(M),L=a(_,!0);t(_);var O=v(_,2),J=a(O,!0);t(O);var Q=v(O,2),ue=a(Q,!0);t(Q);var oe=v(Q,2),de=a(oe);xe(de,{level:2,onclick:()=>o(l,!0),children:(ce,z)=>{we();var k=ye();A(()=>u(k,s.account.convertAccount)),d(ce,k)},$$slots:{default:!0}}),t(oe),A(()=>{u(L,s.account.accTypePasskeyText1),u(J,s.account.accTypePasskeyText2),u(ue,s.account.accTypePasskeyText3)}),d(g,M)};w(h,g=>{(e(n)==="passkey"||e(n)==="federated_passkey")&&!e(l)&&g(G)})}var F=v(h,2);{var me=g=>{var M=la(),_=ke(M),L=a(_);const O=ie(()=>!(e(n)==="password"&&e(T).length<1));ra(L,{get inputWidth(){return e(I)},get hideCurrentPassword(){return e(O)},get passwords(){return e(K)},set passwords(k){o(K,k,!0)},get isValid(){return e(m)},set isValid(k){o(m,k,!0)}});var J=v(L,2),Q=a(J);xe(Q,{onclick:D,level:1,get isLoading(){return e(b)},children:(k,W)=>{we();var j=ye();A(()=>u(j,s.common.save)),d(k,j)},$$slots:{default:!0}});var ue=v(Q,2);{var oe=k=>{var W=va(),j=a(W);dt(j,{}),t(W),Ne(3,W,()=>Re),d(k,W)},de=(k,W)=>{{var j=H=>{var N=oa(),pe=a(N,!0);t(N),A(()=>u(pe,e(x))),Ne(3,N,()=>Re),d(H,N)},fe=(H,N)=>{{var pe=le=>{var Ie=na(),Pe=a(Ie);xe(Pe,{level:3,onclick:()=>o(l,!1),children:(Le,ft)=>{we();var ze=ye();A(()=>u(ze,s.common.cancel)),d(Le,ze)},$$slots:{default:!0}}),t(Ie),d(le,Ie)};w(H,le=>{e(l)&&!e(b)&&le(pe)},N)}};w(k,H=>{e(x)?H(j):H(fe,!1)},W)}};w(ue,k=>{e(c)?k(oe):k(de,!1)})}t(J),t(_);var ce=v(_,2);{var z=k=>{var W=ia(),j=a(W),fe=a(j,!0);t(j);var H=v(j,2),N=a(H,!0);t(H);var pe=v(H,2);xe(pe,{level:2,onclick:X,children:(le,Ie)=>{we();var Pe=ye();A(()=>u(Pe,s.account.convertAccount)),d(le,Pe)},$$slots:{default:!0}}),t(W),A(()=>{u(fe,s.account.convertAccount),u(N,s.account.convertAccountP1)}),d(k,W)};w(ce,k=>{!e(l)&&e(Y)&&k(z)})}d(g,M)};w(F,g=>{(e(n)==="password"||e(n)==="federated_password"||e(l))&&g(me)})}t(ee),d(re,ee),Ce()}function da(re,i){re.code==="Enter"&&i()}var ca=P('<div class="flex"><div class="label font-label noselect svelte-1xf5lr3"><!></div> <label class="switch svelte-1xf5lr3"><input type="checkbox" class="svelte-1xf5lr3"> <span class="slider slider-round svelte-1xf5lr3"></span></label></div>');function Et(re,i){Te(i,!0);let r=ve(i,"checked",15,!1),s=ve(i,"ariaLabel",3,""),I=ve(i,"name",3,"");function n(){r(!r())}var T=ca(),m=a(T);let l;var b=a(m);kr(b,()=>i.children),t(m);var x=v(m,2),c=a(x);sr(c),c.__click=n,c.__keydown=[da,n],we(2),t(x),t(T),A(()=>{l=et(m,"",l,{width:i.labelWidth}),he(c,"name",I()),c.disabled=i.disabled,he(c,"aria-checked",r()),he(c,"aria-label",s())}),Pr(c,r),d(re,T),Ce()}Ct(["click","keydown"]);function fa(re,i){i()}function _a(re,i,r){switch(i(),re.code){case"ArrowUp":r.onUp?.();break;case"ArrowDown":r.onDown?.();break;case"ArrowLeft":r.onLeft?.();break;case"ArrowRight":r.onRight?.();break}}var ma=P('<div class="error svelte-y71ny6"> </div>'),pa=P(`<div class="container svelte-y71ny6"><textarea autocomplete="off">
    </textarea> <div class="label svelte-y71ny6"><label class="font-label noselect svelte-y71ny6"> </label> <!></div></div>`);function ha(re,i){Te(i,!0);let r=ve(i,"ref",15),s=ve(i,"value",15,""),I=ve(i,"label",3,""),n=ve(i,"rows",3,3),T=ve(i,"placeholder",3,""),m=ve(i,"errMsg",3,""),l=ve(i,"disabled",3,!1),b=ve(i,"fontMono",3,!1),x=ve(i,"required",3,!1),c=ve(i,"isError",15,!1),C=ve(i,"width",3,"inherit");const K=i.pattern?new RegExp(i.pattern,"gm"):void 0;function Y(y){D(),i.onBlur?.()}function te(y){y.preventDefault(),c(!0)}function X(y){D()}function D(){return K&&(s().match(K).length>2?(r()?.setCustomValidity(m()),c(!0)):(r()?.setCustomValidity(""),c(!1))),!0}var Z=pa();let se;var f=a(Z);rr(f),f.__input=[fa,D],f.__keydown=[_a,D,i];let U;Tr(f,y=>r(y),()=>r());var $=v(f,2),ee=a($),S=a(ee,!0);t(ee);var E=v(ee,2);{var p=y=>{var h=ma(),G=a(h,!0);t(h),A(()=>u(G,m())),Ne(3,h,()=>Lt,()=>({duration:150})),d(y,h)};w(E,y=>{c()&&y(p)})}t($),t(Z),A(y=>{se=et(Z,"",se,{width:C()}),he(f,"id",i.id),he(f,"name",i.name),he(f,"title",m()),he(f,"aria-label",I()||T()),he(f,"rows",n()),he(f,"placeholder",T()),he(f,"aria-placeholder",T()),f.disabled=l(),he(f,"aria-disabled",l()),he(f,"maxlength",i.maxLength||void 0),f.required=x()||void 0,he(f,"aria-required",x()||!1),he(f,"aria-invalid",c()),U=q(f,1,"svelte-y71ny6",null,U,y),he(ee,"for",i.id),he(ee,"data-required",x()),u(S,I())},[()=>({"font-mono":b()})]),st("submit",f,X),st("invalid",f,te),st("blur",f,Y),Ir(f,s),d(re,Z),Ce()}Ct(["input","keydown"]);var ga=P("<div><p> </p> <!></div>"),wa=P('<div class="success svelte-5kivuv"><!></div>'),ba=P('<div class="err svelte-5kivuv"> </div>'),ya=P('<div class="container svelte-5kivuv"><p> </p> <p><!></p> <div class="switch svelte-5kivuv"><!></div> <div class="switch svelte-5kivuv"><!></div> <!> <div class="bottom svelte-5kivuv"><!> <!></div></div>');function Tt(re,i){Te(i,!0);let r=ve(i,"webIdData",15),s=Ae();const I="14rem";let n=R(""),T=R(!1),m=R(!!r().custom_triples),l=nt(r().user_id);async function b(){o(n,"");let p=await ut(`/auth/v1/users/${r().user_id}/webid/data`,r());p.error?o(n,p.error.message,!0):(o(T,!0),setTimeout(()=>{o(T,!1)},3e3))}var x=ya(),c=a(x),C=a(c,!0);t(c);var K=v(c,2),Y=a(K);Er(Y,{href:l,target:"_blank",children:(p,y)=>{var h=Ve(),G=ke(h);Mt(G,()=>l.replace("/auth/","/auth/<wbr/>")),d(p,h)},$$slots:{default:!0}}),t(K);var te=v(K,2),X=a(te);Et(X,{ariaLabel:"E-Mail",labelWidth:I,get checked(){return r().expose_email},set checked(p){r(r().expose_email=p,!0)},children:(p,y)=>{we();var h=ye("E-Mail");d(p,h)},$$slots:{default:!0}}),t(te);var D=v(te,2),Z=a(D);Et(Z,{get ariaLabel(){return s.account.webIdExpertMode},labelWidth:I,get checked(){return e(m)},set checked(p){o(m,p,!0)},children:(p,y)=>{we();var h=ye();A(()=>u(h,s.account.webIdExpertMode)),d(p,h)},$$slots:{default:!0}}),t(D);var se=v(D,2);{var f=p=>{var y=ga(),h=a(y),G=a(h,!0);t(h);var F=v(h,2);ha(F,{placeholder:"FOAF",rows:15,get value(){return r().custom_triples},set value(me){r(r().custom_triples=me,!0)}}),t(y),A(()=>u(G,s.account.webIdDescData)),Ne(3,y,()=>Lt,()=>({duration:150})),d(p,y)};w(se,p=>{e(m)&&p(f)})}var U=v(se,2),$=a(U);xe($,{onclick:b,children:(p,y)=>{we();var h=ye();A(()=>u(h,s.common.save)),d(p,h)},$$slots:{default:!0}});var ee=v($,2);{var S=p=>{var y=wa(),h=a(y);dt(h,{}),t(y),Ne(3,y,()=>Re),d(p,y)},E=(p,y)=>{{var h=G=>{var F=ba(),me=a(F,!0);t(F),A(()=>u(me,e(n))),Ne(3,F,()=>Re),d(G,F)};w(p,G=>{e(n)&&G(h)},y)}};w(ee,p=>{e(T)?p(S):p(E,!1)})}t(U),t(x),A(()=>u(C,s.account.webIdDesc)),d(re,x),Ce()}function xa(re,i){Te(i,!0);let r=ct("account"),s=ie(()=>r.get()?.user_id);var I=Ve(),n=ke(I);{var T=m=>{At(m,{viewMode:"account",get userId(){return e(s)}})};w(n,m=>{e(s)&&m(T)})}d(re,I),Ce()}var ka=P("<h3> </h3>"),Pa=P('<div class="headerPhone svelte-3a6iwi"><!></div> <div class="container svelte-3a6iwi"><!> <div class="innerPhone svelte-3a6iwi"><!></div></div>',1),Ia=P('<div clasS="info svelte-3a6iwi"><!></div>'),Ea=P('<div class="flex gap-05"><!> </div>'),Ta=P('<div class="wide svelte-3a6iwi"><!> <div class="container svelte-3a6iwi"><!> <div class="inner svelte-3a6iwi"><!></div></div> <div class="logout svelte-3a6iwi"><!></div></div>'),Ca=P('<!> <div class="wrapper svelte-3a6iwi"><!></div>',1);function Da(re,i){Te(i,!0);const r=f=>{var U=ka(),$=a(U,!0);t(U),A(()=>u($,`${s().given_name} ${s().family_name||""}`)),d(f,U)};let s=ve(i,"user",15),I=ve(i,"webIdData",15),n=Ae(),T=R(void 0),m=R(We([])),l=ie(()=>{if(s().account_type?.startsWith("federated"))return e(m).filter(f=>f.id===s().auth_provider_id)[0]}),b=ie(()=>e(T)&&e(T)<560),x=ie(()=>e(T)&&e(T)<1e3),c=R(We(n.account.navInfo)),C=ie(()=>I()?[n.account.navInfo,n.account.navMfa,n.account.devices,n.account.navEdit,n.common.password,"WebID",n.account.navLogout]:[n.account.navInfo,n.account.navMfa,n.account.devices,n.account.navEdit,n.common.password,n.account.navLogout]),K=ie(()=>I()?[n.account.navMfa,n.account.devices,n.account.navEdit,n.common.password,"WebID"]:[n.account.navMfa,n.account.devices,n.account.navEdit,n.common.password]);Ze(()=>{Dr("v").get()==="devices"&&o(c,n.account.devices,!0)}),qe(()=>{e(b)||e(x)?o(c,n.account.navInfo,!0):o(c,n.account.navMfa,!0)}),qe(()=>{e(c)===n.account.navLogout&&bt()});var Y=Ca(),te=ke(Y);Cr(te,{id:ur,get value(){return e(m)},set value(f){o(m,f,!0)}});var X=v(te,2),D=a(X);{var Z=f=>{var U=Pa(),$=ke(U),ee=a($);r(ee),t($);var S=v($,2),E=a(S);xt(E,{get tabs(){return e(C)},get selected(){return e(c)},set selected(F){o(c,F,!0)}});var p=v(E,2),y=a(p);{var h=F=>{ot(F,{get providers(){return e(m)},get authProvider(){return e(l)},viewModePhone:!0,get webIdData(){return I()},get user(){return s()},set user(me){s(me)}})},G=(F,me)=>{{var g=_=>{kt(_,{viewModePhone:!0,get user(){return s()},set user(L){s(L)}})},M=(_,L)=>{{var O=Q=>{It(Q,{get user(){return s()},get authProvider(){return e(l)},viewModePhone:!0})},J=(Q,ue)=>{{var oe=ce=>{Pt(ce,{get user(){return s()}})},de=(ce,z)=>{{var k=j=>{var fe=Ve(),H=ke(fe);{var N=pe=>{Tt(pe,{get webIdData(){return I()},set webIdData(le){I(le)}})};w(H,pe=>{I()&&pe(N)})}d(j,fe)},W=(j,fe)=>{{var H=N=>{At(N,{get userId(){return s().id}})};w(j,N=>{e(c)===n.account.devices&&N(H)},fe)}};w(ce,j=>{e(c)==="WebID"?j(k):j(W,!1)},z)}};w(Q,ce=>{e(c)===n.account.navMfa?ce(oe):ce(de,!1)},ue)}};w(_,Q=>{e(c)===n.common.password?Q(O):Q(J,!1)},L)}};w(F,_=>{e(c)===n.account.navEdit?_(g):_(M,!1)},me)}};w(y,F=>{e(c)===n.account.navInfo?F(h):F(G,!1)})}t(p),t(S),d(f,U)},se=f=>{var U=Ta(),$=a(U);{var ee=M=>{var _=Ia(),L=a(_);ot(L,{get webIdData(){return I()},get providers(){return e(m)},get authProvider(){return e(l)},get user(){return s()},set user(O){s(O)}}),t(_),d(M,_)};w($,M=>{e(x)||M(ee)})}var S=v($,2),E=a(S);const p=ie(()=>e(x)?e(C):e(K));xt(E,{get tabs(){return e(p)},center:!0,get selected(){return e(c)},set selected(M){o(c,M,!0)}});var y=v(E,2),h=a(y);{var G=M=>{ot(M,{get webIdData(){return I()},get providers(){return e(m)},get authProvider(){return e(l)},get user(){return s()},set user(_){s(_)}})},F=(M,_)=>{{var L=J=>{kt(J,{get user(){return s()},set user(Q){s(Q)}})},O=(J,Q)=>{{var ue=de=>{It(de,{get user(){return s()},get authProvider(){return e(l)}})},oe=(de,ce)=>{{var z=W=>{Pt(W,{get user(){return s()}})},k=(W,j)=>{{var fe=N=>{var pe=Ve(),le=ke(pe);{var Ie=Pe=>{Tt(Pe,{get webIdData(){return I()},set webIdData(Le){I(Le)}})};w(le,Pe=>{I()&&Pe(Ie)})}d(N,pe)},H=(N,pe)=>{{var le=Ie=>{xa(Ie,{})};w(N,Ie=>{e(c)===n.account.devices&&Ie(le)},pe)}};w(W,N=>{e(c)==="WebID"?N(fe):N(H,!1)},j)}};w(de,W=>{e(c)===n.account.navMfa?W(z):W(k,!1)},ce)}};w(J,de=>{e(c)===n.common.password?de(ue):de(oe,!1)},Q)}};w(M,J=>{e(c)===n.account.navEdit?J(L):J(O,!1)},_)}};w(h,M=>{e(c)===n.account.navInfo?M(G):M(F,!1)})}t(y),t(S);var me=v(S,2),g=a(me);xe(g,{level:-3,onclick:bt,children:(M,_)=>{var L=Ea(),O=a(L);Mr(O,{});var J=v(O);t(L),A(()=>{he(L,"title",n.account.navLogout),u(J,` ${n.account.navLogout??""}`)}),d(M,L)},$$slots:{default:!0}}),t(me),t(U),d(f,U)};w(D,f=>{e(b)?f(Z):f(se,!1)})}t(X),vr("innerWidth",f=>o(T,f,!0)),d(re,Y),Ce()}var Ma=P("<!> <!> <!>",1);function ps(re,i){Te(i,!0);let r=Ae(),s=ct("account"),I=R(void 0),n=R(void 0),T=R(!1);qe(()=>{let l=s.get();l&&m(l)});async function m(l){const b=l.user_id;if(b){let x=await Promise.all([Ue(`/auth/v1/users/${b}`),Ue(`/auth/v1/users/${b}/webid/data`)]);x[0].body?o(I,x[0].body,!0):dr("account"),x[1].body?o(n,x[1].body,!0):x[1].status===404&&o(n,{user_id:b,expose_email:!1},!0),o(T,!0)}else console.error("no user_id in session")}ar(l=>{A(()=>tr.title=`${r?.account.account||"Account"} ${e(I)?.email??""}`)}),Lr(re,{children:(l,b)=>{Nr(l,{children:(x,c)=>{var C=Ma(),K=ke(C);{var Y=D=>{Da(D,{get user(){return e(I)},set user(Z){o(I,Z,!0)},get webIdData(){return e(n)},set webIdData(Z){o(n,Z,!0)}})};w(K,D=>{e(T)&&s&&e(I)&&D(Y)})}var te=v(K,2);Ar(te,{absolute:!0});var X=v(te,2);Wr(X,{absolute:!0}),d(x,C)}})}}),Ce()}export{ps as component};
