import{t as b,e as U,a as i,d as ve}from"../chunks/DiP_w2ew.js";import{p as Q,k as S,a2 as W,a6 as H,l as a,f as j,a4 as z,t as L,s as T,j as e,a5 as ee,c as B,r as F,a as X,a1 as me}from"../chunks/C0XrmWuC.js";import{s as N}from"../chunks/D9PF6UkP.js";import{i as O}from"../chunks/656WzJtY.js";import{e as fe}from"../chunks/CJENaP9_.js";import{u as Y}from"../chunks/TwEUzhIy.js";import{O as pe}from"../chunks/Tc1XJeMx.js";import{g as _e,d as ge,b as he,f as ne}from"../chunks/DMieIo7a.js";import{C as xe}from"../chunks/Bm0BZ32G.js";import{N as Se}from"../chunks/DT9JRqIQ.js";import{B as be}from"../chunks/CocMgBlr.js";import{N as ye}from"../chunks/B-yCTmx-.js";import{u as Pe}from"../chunks/wGIx8MYF.js";import{M as K}from"../chunks/Cx6cA6Ki.js";import{B as se}from"../chunks/Buvqu-RJ.js";import{I as le}from"../chunks/yQnwIU9m.js";import{I as we}from"../chunks/BfhzFwm0.js";import{u as te}from"../chunks/CIAGEtKU.js";import{F as ce}from"../chunks/CGfBumSq.js";import{L as Ce}from"../chunks/Buhh8tsS.js";import{S as ie}from"../chunks/DUGdZrhU.js";import{f as ue}from"../chunks/DzmDou2k.js";import{T as Ae}from"../chunks/CR5YEZgY.js";var Te=b("<p> </p>"),Ie=b("<p> </p> <p> </p> <!> <!>",1),De=b('<div class="err"> </div>'),Me=b('<div class="flex gap-05"><!> <!></div> <!>',1),Ne=b("<!> <!> <!> <!>",1);function Oe(E,r){Q(r,!0);let q=te(),g=Y(),u=S(""),f=S(!1),y=ee(()=>K(r.scope.name)),l=S(W(r.scope.name)),d=S(void 0),w=S(void 0);H(()=>{r.scope.id&&a(l,r.scope.name,!0)}),H(()=>{K(r.scope.name)?(a(d,void 0),a(w,void 0)):(a(d,r.attrs.map(s=>({name:s.name,selected:r.scope.attr_include_access?.includes(s.name)||!1})).toSorted((s,o)=>s.name.localeCompare(o.name)),!0),a(w,r.attrs.map(s=>({name:s.name,selected:r.scope.attr_include_id?.includes(s.name)||!1})).toSorted((s,o)=>s.name.localeCompare(o.name)),!0))});async function v(s,o){if(a(u,""),K(e(l))||r.scope.name!==e(l)&&r.scopes.find(h=>h.name===e(l))){a(u,g.common.nameExistsAlready,!0);return}let P={scope:e(l)};if(e(d)){let h=e(d).filter(n=>n.selected).map(n=>n.name);h.length>0&&(P.attr_include_access=h)}if(e(w)){let h=e(w).filter(n=>n.selected).map(n=>n.name);h.length>0&&(P.attr_include_id=h)}let I=await _e(s.action,P);I.error?a(u,I.error.message,!0):(a(f,!0),r.onSave(),setTimeout(()=>{a(f,!1)},2e3))}const C=ee(()=>`/auth/v1/scopes/${r.scope.id}`);ce(E,{get action(){return e(C)},onSubmit:v,children:(s,o)=>{var P=Ne(),I=j(P);Ce(I,{label:"ID",mono:!0,children:(t,p)=>{z();var c=U();L(()=>N(c,r.scope.id)),i(t,c)},$$slots:{default:!0}});var h=T(I,2);le(h,{autocomplete:"off",get label(){return g.scopes.name},get placeholder(){return g.scopes.name},get disabled(){return e(y)},width:"14.5rem",required:!0,pattern:ue,get value(){return e(l)},set value(t){a(l,t,!0)}});var n=T(h,2);{var k=t=>{var p=Te(),c=B(p,!0);F(p),L(()=>N(c,g.scopes.defaultNoMod)),i(t,p)},M=t=>{var p=Ie(),c=j(p),x=B(c,!0);F(c);var _=T(c,2),G=B(_,!0);F(_);var V=T(_,2);{var D=A=>{ie(A,{get items(){return e(d)},set items(R){a(d,R,!0)},children:(R,ae)=>{z();var J=U("Access Token Mappings");i(R,J)},$$slots:{default:!0}})};O(V,A=>{e(d)&&A(D)})}var m=T(V,2);{var $=A=>{ie(A,{get items(){return e(w)},set items(R){a(w,R,!0)},children:(R,ae)=>{z();var J=U("Id Token Mappings");i(R,J)},$$slots:{default:!0}})};O(m,A=>{e(w)&&A($)})}L(()=>{N(x,g.scopes.mapping1),N(G,g.scopes.mapping2)}),i(t,p)};O(n,t=>{e(y)?t(k):t(M,!1)})}var Z=T(n,2);{var re=t=>{var p=Me(),c=j(p),x=B(c);se(x,{type:"submit",children:(m,$)=>{z();var A=U();L(()=>N(A,q.common.save)),i(m,A)},$$slots:{default:!0}});var _=T(x,2);{var G=m=>{we(m,{})};O(_,m=>{e(f)&&m(G)})}F(c);var V=T(c,2);{var D=m=>{var $=De(),A=B($,!0);F($),L(()=>N(A,e(u))),i(m,$)};O(V,m=>{e(u)&&m(D)})}i(t,p)};O(Z,t=>{e(y)||t(re)})}i(s,P)},$$slots:{default:!0}}),X()}var Fe=b("<p> </p>"),ke=b('<div class="err"> </div>'),Le=b("<p> </p> <!> <!>",1);function Be(E,r){Q(r,!0);let q=te(),g=Y(),u=S("");async function f(){a(u,"");let v=await ge(`/auth/v1/scopes/${r.scope.id}`);v.error?a(u,v.error.message,!0):r.onSave()}var y=ve(),l=j(y);{var d=v=>{var C=Fe(),s=B(C,!0);F(C),L(()=>N(s,g.scopes.deleteDefault)),i(v,C)},w=v=>{var C=Le(),s=j(C),o=B(s,!0);F(s);var P=T(s,2);se(P,{level:-1,onclick:f,children:(n,k)=>{z();var M=U();L(()=>N(M,q.common.delete)),i(n,M)},$$slots:{default:!0}});var I=T(P,2);{var h=n=>{var k=ke(),M=B(k,!0);F(k),L(()=>N(M,e(u))),i(n,k)};O(I,n=>{e(u)&&n(h)})}L(()=>N(o,g.scopes.delete1)),i(v,C)};O(l,v=>{K(r.scope.name)?v(d):v(w,!1)})}i(E,y),X()}var Ee=b('<div class="flex"><!></div> <!>',1);function qe(E,r){Q(r,!0);let q=te(),g=Y();const u=[g.nav.config,q.common.delete];let f=S(W(u[0])),y=S(void 0);H(()=>{r.scope.id&&requestAnimationFrame(()=>{e(y)?.()})});var l=Ee(),d=j(l),w=B(d);Ae(w,{tabs:u,get selected(){return e(f)},set selected(o){a(f,o,!0)},get focusFirst(){return e(y)},set focusFirst(o){a(y,o,!0)}}),F(d);var v=T(d,2);{var C=o=>{Oe(o,{get attrs(){return r.attrs},get scope(){return r.scope},get scopes(){return r.scopes},get onSave(){return r.onSave}})},s=(o,P)=>{{var I=h=>{Be(h,{get scope(){return r.scope},get onSave(){return r.onSave}})};O(o,h=>{e(f)===q.common.delete&&h(I)},P)}};O(v,o=>{e(f)===g.nav.config?o(C):o(s,!1)})}i(E,l),X()}var $e=b('<div class="err"> </div>'),je=b("<!> <!> <!>",1),Re=b('<div class="container svelte-s1196z"><!></div>');function Ge(E,r){Q(r,!0);let q=te(),g=Y(),u=S(void 0),f=S(""),y=S("");H(()=>{requestAnimationFrame(()=>{e(u)?.focus()})});async function l(v,C){if(r.scopes.find(P=>P.name===e(y))){a(f,g.common.nameExistsAlready,!0);return}a(f,"");let s={scope:e(y)},o=await he(v.action,s);o.body?r.onSave(o.body.id):a(f,o.error?.message||"Error",!0)}var d=Re(),w=B(d);ce(w,{action:"/auth/v1/scopes",onSubmit:l,children:(v,C)=>{var s=je(),o=j(s);le(o,{autocomplete:"off",get label(){return g.scopes.name},get placeholder(){return g.scopes.name},required:!0,pattern:ue,get ref(){return e(u)},set ref(n){a(u,n,!0)},get value(){return e(y)},set value(n){a(y,n,!0)}});var P=T(o,2);se(P,{type:"submit",children:(n,k)=>{z();var M=U();L(()=>N(M,q.common.save)),i(n,M)},$$slots:{default:!0}});var I=T(P,2);{var h=n=>{var k=$e(),M=B(k,!0);F(k),L(()=>N(M,e(f))),i(n,k)};O(I,n=>{e(f)&&n(h)})}i(v,s)},$$slots:{default:!0}}),F(d),i(E,d),X()}var Ve=b('<span class="default svelte-16jus8a"><i>default</i></span>'),ze=b(" <!>",1),Ue=b('<div class="scopesList svelte-16jus8a"></div>'),We=b("<!> <!>",1),He=b('<div class="err"> </div>'),Je=b('<!> <div id="scopes"><!></div>',1),Ke=b("<!> <!>",1);function Qe(E,r){Q(r,!0);let q=Y(),g=S(void 0),u=S(""),f=Pe("sid"),y=S(W([])),l=S(W([])),d=S(W([])),w=S(void 0);const v=[q.common.name,"ID"];let C=S(W(v[0])),s=S("");const o=[q.common.name,"ID"];me(()=>{I(),P()}),H(()=>{a(w,e(l).find(t=>t.id===f.get()),!0)}),H(()=>{let t=e(s).toLowerCase();t?e(C)===v[0]?a(d,e(l).filter(p=>p.name?.toLowerCase().includes(t)),!0):e(C)===v[1]&&a(d,e(l).filter(p=>p.id.toLowerCase().includes(t)),!0):a(d,e(l),!0)});async function P(){let t=await ne("/auth/v1/users/attr");t.body?a(y,t.body.values,!0):a(u,t.error?.message||"Error",!0)}async function I(){let t=await ne("/auth/v1/scopes");t.body?a(l,t.body,!0):a(u,t.error?.message||"Error",!0)}function h(t,p){let c=p==="up";t===o[0]?e(l).sort((x,_)=>c?x.name.localeCompare(_.name):_.name.localeCompare(x.name)):t===o[1]&&e(l).sort((x,_)=>c?x.id.localeCompare(_.id):_.id.localeCompare(x.id))}function n(){I()}async function k(t){e(g)?.(),await I(),f.set(t)}var M=Ke(),Z=j(M);ye(Z,{paddingTop:"2.1rem",buttonTilesAriaControls:"scopes",width:"min(20rem, 100dvw)",thresholdNavSub:700,buttonTiles:p=>{var c=Ue();fe(c,21,()=>e(d),x=>x.id,(x,_,G,V)=>{const D=ee(()=>f.get()===e(_).id);Se(x,{onclick:()=>f.set(e(_).id),get selected(){return e(D)},children:(m,$)=>{z();var A=ze(),R=j(A),ae=T(R);{var J=oe=>{var de=Ve();i(oe,de)};O(ae,oe=>{K(e(_).name)&&oe(J)})}L(()=>N(R,`${e(_).name??""} `)),i(m,A)}})}),F(c),i(p,c)},children:(p,c)=>{var x=We(),_=j(x);const G=ee(()=>e(l).length===0?1:2);be(_,{get level(){return e(G)},alignRight:!0,get closeModal(){return e(g)},set closeModal(D){a(g,D,!0)},children:(D,m)=>{Ge(D,{onSave:k,get scopes(){return e(l)}})},$$slots:{default:!0}});var V=T(_,2);pe(V,{searchOptions:v,orderOptions:o,onChangeOrder:h,searchWidth:"min(19.5rem, 100dvw - .5rem)",get searchOption(){return e(C)},set searchOption(D){a(C,D,!0)},get value(){return e(s)},set value(D){a(s,D,!0)}}),i(p,x)},$$slots:{buttonTiles:!0,default:!0}});var re=T(Z,2);xe(re,{children:(t,p)=>{var c=Je(),x=j(c);{var _=m=>{var $=He(),A=B($,!0);F($),L(()=>N(A,e(u))),i(m,$)};O(x,m=>{e(u)&&m(_)})}var G=T(x,2),V=B(G);{var D=m=>{qe(m,{get attrs(){return e(y)},get scope(){return e(w)},get scopes(){return e(l)},onSave:n})};O(V,m=>{e(w)&&m(D)})}F(G),i(t,c)}}),i(E,M),X()}function St(E){Qe(E,{})}export{St as component};
