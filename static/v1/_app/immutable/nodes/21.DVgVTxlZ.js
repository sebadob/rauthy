import{n as he,a as u,t as L,e as z,d as se}from"../chunks/DVyqXkF9.js";import{t as f,p as ae,k as x,a2 as V,c as $,r as y,a as le,s as _,j as s,a5 as xe,f as K,a4 as U,l as a,a1 as we,a6 as Pe}from"../chunks/DXTz3Rbt.js";import{s as w}from"../chunks/BLUcFBb0.js";import{i as Z}from"../chunks/Dnzfvyee.js";import{e as re}from"../chunks/Dus-q-Em.js";import{j as X,r as Se}from"../chunks/Cx6cA6Ki.js";import{B as N}from"../chunks/BaLU91-Z.js";import{P as oe}from"../chunks/BLt68qL4.js";import{s as q,b as $e,a as ye}from"../chunks/B28jQOFH.js";import{C as Ce}from"../chunks/CdgZ0Q70.js";import{E as Ie}from"../chunks/BhqqWH90.js";import{T as J}from"../chunks/DfNjsX4D.js";import{u as De}from"../chunks/pXVVLMtZ.js";import{u as ne}from"../chunks/T3uKKWzz.js";import{L as M}from"../chunks/BlWtnSFg.js";import{p as Y}from"../chunks/D54UoLP7.js";import{d as de,f as be}from"../chunks/DMieIo7a.js";import{C as Te}from"../chunks/CL_mTQmm.js";import{O as ke}from"../chunks/99krErCG.js";import{u as Le}from"../chunks/iM7h-bm7.js";import{P as Oe,f as Fe,a as Ae}from"../chunks/DEp-tmMd.js";var Ee=he(`<svg fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25
            2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0
            0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5
            0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5
            0a48.667 48.667 0 0 0-7.5 0"></path></svg>`);function ze(B,l){let P=Y(l,"opacity",3,.9),h=Y(l,"width",3,"1.5rem"),n=Y(l,"color",3,"hsl(var(--error))");var v=Ee();q(v,"stroke-width",2),f(()=>{q(v,"stroke",n()),q(v,"width",h()),q(v,"opacity",P())}),u(B,v)}var Ue=L('<div class="uid font-mono svelte-79owtg"> </div>'),Be=L('<div class="date svelte-79owtg"> </div>'),je=L('<div class="ip font-mono svelte-79owtg"> </div>'),He=L('<div class="trash svelte-79owtg"><!></div>'),Ge=L('<div class="header svelte-79owtg"><!> <div class="headerRight svelte-79owtg"><!> <!> <!></div></div>'),Me=L("<!> <!> <!> <!> <!> <!> <!> <!>",1),Re=L("<div><!></div>");function ie(B,l){ae(l,!0);let P=De(),h=ne(),n=x(V(P.common.copyToClip));function v(){l.session.remote_ip&&(navigator.clipboard.writeText(l.session.remote_ip),a(n,h.common.copiedToClip,!0),setTimeout(()=>{a(n,P.common.copyToClip,!0)},3e3))}async function O(){let C=await de(`/auth/v1/sessions/id/${l.session.id}`);C.error?console.error(C.error):l.onDeleted(l.session.id)}var F=Re();let j;var A=$(F);Ie(A,{summary:S=>{var c=Ge(),b=$(c);J(b,{text:"User ID",children:(g,E)=>{var o=Ue();let r;var t=$(o,!0);y(o),f(()=>{r=ye(o,"",r,{"margin-left":l.session.user_id?"":".35rem"}),w(t,l.session.user_id)}),u(g,o)},$$slots:{default:!0}});var p=_(b,2),H=$(p);J(H,{get text(){return h.options.lastSeen},children:(g,E)=>{var o=Be(),r=$(o,!0);y(o),f(t=>w(r,t),[()=>X(l.session.last_seen)]),u(g,o)},$$slots:{default:!0}});var T=_(H,2);N(T,{invisible:!0,onclick:v,children:(g,E)=>{const o=xe(()=>`IP - ${s(n)}`);J(g,{get text(){return s(o)},children:(r,t)=>{var e=je(),i=$(e,!0);y(e),f(()=>w(i,l.session.remote_ip)),u(r,e)},$$slots:{default:!0}})},$$slots:{default:!0}});var R=_(T,2);N(R,{invisible:!0,onclick:O,children:(g,E)=>{J(g,{get text(){return P.common.delete},children:(o,r)=>{var t=He(),e=$(t);ze(e,{width:"1.2rem"}),y(t),u(o,t)},$$slots:{default:!0}})},$$slots:{default:!0}}),y(p),y(c),u(S,c)},details:S=>{var c=Me(),b=K(c);M(b,{label:"Session ID",children:(r,t)=>{U();var e=z();f(()=>w(e,l.session.id)),u(r,e)},$$slots:{default:!0}});var p=_(b,2);M(p,{label:"User ID",children:(r,t)=>{U();var e=z();f(()=>w(e,l.session.user_id)),u(r,e)},$$slots:{default:!0}});var H=_(p,2);M(H,{get label(){return h.options.expires},children:(r,t)=>{U();var e=z();f(i=>w(e,i),[()=>X(l.session.exp)]),u(r,e)},$$slots:{default:!0}});var T=_(H,2);M(T,{get label(){return h.options.lastSeen},children:(r,t)=>{U();var e=z();f(i=>w(e,i),[()=>X(l.session.last_seen)]),u(r,e)},$$slots:{default:!0}});var R=_(T,2);M(R,{get label(){return h.options.state},children:(r,t)=>{U();var e=z();f(()=>w(e,l.session.state)),u(r,e)},$$slots:{default:!0}});var g=_(R,2);M(g,{label:"IP",children:(r,t)=>{U();var e=z();f(()=>w(e,l.session.remote_ip)),u(r,e)},$$slots:{default:!0}});var E=_(g,2);M(E,{label:"MFA",children:(r,t)=>{Ce(r,{get checked(){return l.session.is_mfa}})},$$slots:{default:!0}});var o=_(E,2);N(o,{level:-1,onclick:O,children:(r,t)=>{U();var e=z();f(()=>w(e,P.common.delete)),u(r,e)},$$slots:{default:!0}}),u(S,c)},$$slots:{summary:!0,details:!0}}),y(F),f(C=>j=$e(F,1,"container svelte-79owtg",null,j,C),[()=>({expired:l.session.exp<l.now})]),u(B,F),le()}var Ve=L('<div class="err"> </div>'),We=L('<div class="top svelte-12u9cg2"><!> <div class="btn svelte-12u9cg2"><!></div></div> <!> <div id="sessions" class="svelte-12u9cg2"><!></div> <!>',1);function Ze(B,l){ae(l,!0);let P=ne(),h=x(""),n=x(V([])),v=x(V([])),O=x(V([])),F=x(Date.now()/1e3),j=x(!1),A=x(void 0),C=x(V(Oe)),W=x(!1),S=["User ID","Session ID","IP"],c=x(V(S[0])),b=x(""),p=[P.options.expires,P.options.lastSeen,"Session ID","User ID",P.options.state,"IP"];we(()=>{T("page_size="+s(C))}),Pe(()=>{let o=s(b).toLowerCase();s(j)?o.length<3?s(W)&&(T("page_size="+s(C)),a(W,!1)):H(o):o?s(c)===S[0]?a(v,s(n).filter(r=>r.user_id?.toLowerCase().includes(o)),!0):s(c)===S[1]?a(v,s(n).filter(r=>r.id.toLowerCase().includes(o)),!0):s(c)===S[2]&&a(v,s(n).filter(r=>r.remote_ip?.toLowerCase().includes(o)),!0):a(v,s(n),!0)});async function H(o){a(A,void 0),a(W,!0);let r;s(c)===S[0]?r="userid":s(c)===S[1]?r="sessionid":r="ip";let t=await Fe({ty:"session",idx:r,q:o});t.body?a(n,t.body,!0):console.error(t.error)}async function T(o){let r="/auth/v1/sessions";o&&(r+=`?${o}`);let t=await be(r);return t.error?a(h,"Error fetching sessions: "+t.error.message):t.body&&(t.status===206?(a(j,!0),a(A,t.headers,!0)):(a(j,!1),a(A,void 0)),a(n,t.body,!0),a(F,Date.now()/1e3)),[t.status,t.headers]}function R(o,r){let t=r==="up";o===p[0]?s(n).sort((e,i)=>t?e.exp-i.exp:i.exp-e.exp):o===p[1]?s(n).sort((e,i)=>t?e.last_seen-i.last_seen:i.last_seen-e.last_seen):o===p[2]?s(n).sort((e,i)=>t?e.id.localeCompare(i.id):i.id.localeCompare(e.id)):o===p[3]?s(n).sort((e,i)=>e.user_id&&i.user_id?t?e.user_id.localeCompare(i.user_id):i.user_id.localeCompare(e.user_id):e.user_id?t?-1:1:t?1:-1):o===p[4]?s(n).sort((e,i)=>t?e.state.localeCompare(i.state):i.state.localeCompare(e.state)):o===p[5]&&s(n).sort((e,i)=>e.remote_ip&&i.remote_ip?t?e.remote_ip.localeCompare(i.remote_ip):i.remote_ip.localeCompare(e.remote_ip):e.remote_ip?t?-1:1:t?1:-1)}function g(o){a(n,s(n).filter(r=>r.id!==o),!0),Le("admin").get()?.id===o&&window.location.reload()}async function E(){let o=await de("/auth/v1/sessions");o.error?a(h,o.error.message,!0):Se()}Te(B,{children:(o,r)=>{var t=We(),e=K(t),i=$(e);ke(i,{searchOptions:S,orderOptions:p,onChangeOrder:R,searchWidth:"min(25rem, calc(100dvw - 1rem))",get value(){return s(b)},set value(d){a(b,d,!0)},get searchOption(){return s(c)},set searchOption(d){a(c,d,!0)}});var ee=_(i,2),ue=$(ee);N(ue,{level:-1,onclick:E,children:(d,m)=>{U();var I=z();f(()=>w(I,P.sessions.invalidateAll)),u(d,I)},$$slots:{default:!0}}),y(ee),y(e);var te=_(e,2);{var ve=d=>{var m=Ve(),I=$(m,!0);y(m),f(()=>w(I,s(h))),u(d,m)};Z(te,d=>{s(h)&&d(ve)})}var Q=_(te,2),ce=$(Q);{var me=d=>{var m=se(),I=K(m);re(I,17,()=>s(n),k=>k.id,(k,D)=>{ie(k,{get session(){return s(D)},get now(){return s(F)},onDeleted:g})}),u(d,m)},fe=d=>{var m=se(),I=K(m);re(I,17,()=>s(O),k=>k.id,(k,D)=>{ie(k,{get session(){return s(D)},get now(){return s(F)},onDeleted:g})}),u(d,m)};Z(ce,d=>{s(A)?d(me):d(fe,!1)})}y(Q);var _e=_(Q,2);{var pe=d=>{Ae(d,{sspFetch:T,get itemsLength(){return s(n).length},get firstFetchHeaders(){return s(A)},get pageSize(){return s(C)},set pageSize(m){a(C,m,!0)}})},ge=(d,m)=>{{var I=D=>{oe(D,{get items(){return s(n)},set items(G){a(n,G,!0)},get itemsPaginated(){return s(O)},set itemsPaginated(G){a(O,G,!0)}})},k=D=>{oe(D,{get items(){return s(v)},set items(G){a(v,G,!0)},get itemsPaginated(){return s(O)},set itemsPaginated(G){a(O,G,!0)}})};Z(d,D=>{s(j)?D(I):D(k,!1)},m)}};Z(_e,d=>{s(A)?d(pe):d(ge,!1)})}u(o,t)}}),le()}function ft(B){Ze(B,{})}export{ft as component};
