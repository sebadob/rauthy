import{t as _,a as l,e as q}from"../chunks/DVyqXkF9.js";import{p as ge,a1 as xe,f as I,a as $e,t as c,l as a,k as p,j as e,s as i,a3 as ze,c as o,r as s,a5 as oe,a4 as H}from"../chunks/DXTz3Rbt.js";import{h as Le,s as d}from"../chunks/BLUcFBb0.js";import{i as M}from"../chunks/Dnzfvyee.js";import{e as Pe,i as Te}from"../chunks/Dus-q-Em.js";import{k as be,r as ie}from"../chunks/Cx6cA6Ki.js";import{L as we}from"../chunks/DTJ9M0WP.js";import{I as Ce,f as Ee}from"../chunks/DVvDmFQc.js";import{B as V}from"../chunks/BaLU91-Z.js";import{M as Se}from"../chunks/BdLPQyv5.js";import{C as ye}from"../chunks/DrM_mJzu.js";import{u as ke}from"../chunks/pXVVLMtZ.js";import{T as Ae}from"../chunks/D83BWmtm.js";import{u as De}from"../chunks/Cg_pJWW9.js";import{T as Ie}from"../chunks/C-Rj8bXN.js";import{f as Me,b as Ne}from"../chunks/QS8tP13U.js";import{P as Re}from"../chunks/DzmDou2k.js";var Be=_('<div class="desc svelte-hzde4x"> </div> <!> <div><!></div>',1),Ge=_('<div class="desc svelte-hzde4x"><p> </p> <p> </p></div>'),Oe=_('<div class="desc svelte-hzde4x"><p class="declined svelte-hzde4x"> </p> <p> </p></div>'),Ue=_('<li class="svelte-hzde4x"> </li>'),We=_('<div class="desc svelte-hzde4x"> <ul class="svelte-hzde4x"></ul></div> <div class="inline svelte-hzde4x"><!> <!></div>',1),je=_('<div class="container svelte-hzde4x"><div class="name svelte-hzde4x"><h2> </h2></div> <!> <div class="err svelte-hzde4x"> </div></div>'),qe=_("<!> <!> <!>",1),He=_("<!> <!>",1);function lt(de,ve){ge(ve,!0);let t=ke(),F=p(void 0),h=p(""),N=p(!1),E=p(!1),g=p(8),R=p(void 0),J=p(!1),K=p(!1),T=p("");xe(async()=>{let $=De("code").get()||"";a(T,$,!0);let b=await Me("/auth/v1/oidc/sessioninfo");b.body?a(F,b.body,!0):$?ie(`device?code=${$}`):ie("device")});async function B(x){if(a(h,""),e(N))return;if(e(T).length<e(g)){a(h,t.common.errTooShort,!0);return}if(e(T).length>e(g)){a(h,t.common.errTooLong,!0);return}a(E,!0);let $=await Ee();if(!$){a(h,"PoW error - please contact your administrator");return}let b={user_code:e(T),pow:$,device_accepted:x},f=await Ne("/auth/v1/oidc/device/verify",b);f.status===200?a(R,f.body?.scopes?.split(" ")||["openid"],!0):f.status===202?(a(J,!0),setTimeout(()=>{window.location.replace("/auth/v1/account?v=devices")},2e3)):f.status===204?a(K,!0):f.status===404?a(h,t.device.wrongOrExpired,!0):(console.error(f),a(h,f.error?.message,!0)),a(E,!1)}var Q=He();Le(x=>{c(()=>ze.title=t?.device.title||"Device Authorization")});var X=I(Q);Ae(X,{id:be,get value(){return e(g)},set value(x){a(g,x,!0)}});var le=i(X,2);Se(le,{children:(x,$)=>{ye(x,{children:(b,f)=>{var Y=qe(),Z=I(Y);{var ce=G=>{var O=je(),U=o(O),te=o(U),ue=o(te,!0);s(te),s(U);var re=i(U,2);{var pe=w=>{var A=Be(),S=I(A),W=o(S,!0);s(S);var n=i(S,2);const z=oe(()=>e(g).toString()),L=oe(()=>e(g).toString());Ce(n,{name:"userCode",autocomplete:"off",get label(){return t.device.userCode},get placeholder(){return t.device.userCode},required:!0,get min(){return e(z)},get max(){return e(L)},pattern:Re,get value(){return e(T)},set value(r){a(T,r,!0)},get isError(){return e(N)},set isError(r){a(N,r,!0)}});var C=i(n,2),v=o(C);V(v,{onclick:()=>B("pending"),get isLoading(){return e(E)},children:(r,m)=>{H();var P=q();c(()=>d(P,t.device.submit)),l(r,P)},$$slots:{default:!0}}),s(C),c(r=>d(W,r),[()=>t.device.desc.replace("{{count}}",e(g).toString())]),l(w,A)},fe=(w,A)=>{{var S=n=>{var z=Ge(),L=o(z),C=o(L,!0);s(L);var v=i(L,2),r=o(v,!0);s(v),s(z),c(()=>{d(C,t.device.isAccepted),d(r,t.device.autoRedirectAccount)}),l(n,z)},W=(n,z)=>{{var L=v=>{var r=Oe(),m=o(r),P=o(m,!0);s(m);var y=i(m,2),D=o(y,!0);s(y),s(r),c(()=>{d(P,t.device.isDeclined),d(D,t.device.closeWindow)}),l(v,r)},C=v=>{var r=We(),m=I(r),P=o(m),y=i(P);Pe(y,21,()=>e(R),Te,(k,j)=>{var u=Ue(),he=o(u,!0);s(u),c(()=>d(he,e(j))),l(k,u)}),s(y),s(m);var D=i(m,2),se=o(D);V(se,{onclick:()=>B("accept"),get isLoading(){return e(E)},children:(k,j)=>{H();var u=q();c(()=>d(u,t.device.accept)),l(k,u)},$$slots:{default:!0}});var _e=i(se,2);V(_e,{level:-1,onclick:()=>B("decline"),get isLoading(){return e(E)},children:(k,j)=>{H();var u=q();c(()=>d(u,t.device.decline)),l(k,u)},$$slots:{default:!0}}),s(D),c(()=>d(P,`${t.device.descScopes??""} `)),l(v,r)};M(n,v=>{e(K)?v(L):v(C,!1)},z)}};M(w,n=>{e(J)?n(S):n(W,!1)},A)}};M(re,w=>{e(R)===void 0?w(pe):w(fe,!1)})}var ae=i(re,2),me=o(ae,!0);s(ae),s(O),c(()=>{d(ue,t.device.title),d(me,e(h))}),l(G,O)};M(Z,G=>{e(F)&&G(ce)})}var ee=i(Z,2);Ie(ee,{absolute:!0});var ne=i(ee,2);we(ne,{absolute:!0}),l(b,Y)}})}}),l(de,Q),$e()}export{lt as component};
