import{t as c,a as n,e as ne}from"../chunks/DVyqXkF9.js";import{p as le,f as N,a as me,t as v,l as i,k as q,j as o,s as r,a3 as ve,c as u,r as d,a4 as ue,a5 as de}from"../chunks/DXTz3Rbt.js";import{h as ce,s as l}from"../chunks/BLUcFBb0.js";import{i as R}from"../chunks/Dnzfvyee.js";import{r as fe,d as _e}from"../chunks/B28jQOFH.js";import{B as pe}from"../chunks/BaLU91-Z.js";import{t as ge}from"../chunks/Cx6cA6Ki.js";import{I as k}from"../chunks/DxMCa-Hz.js";import{L as he}from"../chunks/TrxSD_Cs.js";import{M as xe}from"../chunks/BdLPQyv5.js";import{C as $e}from"../chunks/DrM_mJzu.js";import{u as we}from"../chunks/pXVVLMtZ.js";import{T as be}from"../chunks/DIOStUGY.js";import{u as ye}from"../chunks/21dMcSbF.js";import{T as Te}from"../chunks/C-Rj8bXN.js";import{F as Ee}from"../chunks/BkyS6Cp-.js";import{u as Pe}from"../chunks/D06dnomN.js";import{b as W}from"../chunks/DzmDou2k.js";import{b as Ie}from"../chunks/DMieIo7a.js";var Ne=c(" <br> <code> </code>",1),qe=c('<input type="hidden" name="redirect_uri">'),Re=c('<div class="success svelte-f6xqw3"> <br> </div>'),Ae=c('<div class="err svelte-f6xqw3"> </div>'),Le=c('<!> <!> <!> <!> <div class="submit svelte-f6xqw3"><!></div> <!>',1),Me=c('<div class="container svelte-f6xqw3"><div class="domainTxt svelte-f6xqw3"><h1> </h1> <!></div> <!></div> <!> <!>',1),Ce=c("<!> <!>",1);function er(z,G){le(G,!0);let e=we(),H=Pe(),f=q(""),A=ye("redirect_uri"),L=q(!1),m=q(""),M=q(!1),J=de(()=>H.get()?"/auth/v1/dev/register":"/auth/v1/users/register");async function K(_,p){i(M,!1),i(m,"");let $=p.get("email"),C=p.get("given_name"),w=p.get("pow");if(!$||!C||!w){console.error("email, given_name, pow missing");return}if(o(f)&&!$.endsWith(o(f))){i(m,e.register.domainErr,!0);return}let g={email:$,given_name:C,family_name:p.get("family_name")||void 0,pow:w,redirect_uri:p.get("redirect_uri")||void 0};i(L,!0);const h=await Ie(_.action,g);if(h.error){let x=h.error.message||"Error";x.includes("UNIQUE constraint")?i(m,"E-Mail is already registered"):i(m,x,!0)}else i(m,""),i(M,!0),A&&setTimeout(()=>{window.location.replace(g.redirect_uri||"/auth/v1/account")},3e3);i(L,!1)}var B=Ce();ce(_=>{v(()=>ve.title=e?.register.register||"Register")});var F=N(B);be(F,{id:ge,get value(){return o(f)},set value(_){i(f,_,!0)}});var V=r(F,2);xe(V,{children:(_,p)=>{$e(_,{children:($,C)=>{var w=Me(),g=N(w),h=u(g),x=u(h),X=u(x,!0);d(x);var Y=r(x,2);{var Z=b=>{var D=Ne(),y=N(D,!0),T=r(y,2),P=r(T),I=u(P);d(P),v(()=>{l(y,e.register.domainRestricted),l(T,` ${e.register.domainAllowed??""} `),l(I,`@${o(f)??""}`)}),n(b,D)};R(Y,b=>{o(f)&&b(Z)})}d(h);var ee=r(h,2);Ee(ee,{get action(){return o(J)},onSubmit:K,withPowAs:"pow",children:(b,D)=>{var y=Le(),T=N(y);{var P=t=>{var a=qe();fe(a),v(s=>_e(a,s),[()=>A.get()]),n(t,a)};R(T,t=>{A.get()&&t(P)})}var I=r(T,2);k(I,{typ:"email",name:"email",autocomplete:"email",get label(){return e.common.email},get placeholder(){return e.common.email},required:!0});var O=r(I,2);k(O,{name:"given_name",autocomplete:"given-name",get label(){return e.account.givenName},get placeholder(){return e.account.givenName},pattern:W,required:!0});var Q=r(O,2);k(Q,{name:"family_name",autocomplete:"family-name",get label(){return e.account.familyName},get placeholder(){return e.account.familyName},pattern:W});var S=r(Q,2),te=u(S);pe(te,{type:"submit",get isLoading(){return o(L)},children:(t,a)=>{ue();var s=ne();v(()=>l(s,e.register.register)),n(t,s)},$$slots:{default:!0}}),d(S);var ae=r(S,2);{var ie=t=>{var a=Re(),s=u(a,!0),E=r(s,2);d(a),v(()=>{l(s,e.register.success),l(E,` ${e.register.emailCheck??""}`)}),n(t,a)},oe=(t,a)=>{{var s=E=>{var U=Ae(),se=u(U,!0);d(U),v(()=>l(se,o(m))),n(E,U)};R(t,E=>{o(m)&&E(s)},a)}};R(ae,t=>{o(M)?t(ie):t(oe,!1)})}n(b,y)},$$slots:{default:!0}}),d(g);var j=r(g,2);Te(j,{absolute:!0});var re=r(j,2);he(re,{absolute:!0}),v(()=>l(X,e.register.userReg)),n($,w)}})}}),n(z,B),me()}export{er as component};
