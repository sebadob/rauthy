import{d as K,a as _,t as S}from"./DVyqXkF9.js";import{p as N,a1 as P,l as H,k as M,a6 as G,j as l,f as R,a as Q,c as n,r as c,s as z,t as D}from"./DXTz3Rbt.js";import{s as T}from"./BLUcFBb0.js";import{i as k}from"./Dnzfvyee.js";import{L as V}from"./BaLU91-Z.js";import{A as X,B as Y,p as Z,D as x}from"./Cx6cA6Ki.js";import{b as U}from"./DMieIo7a.js";import{u as $}from"./pXVVLMtZ.js";function ue(o){let t=Y(o);const a={"+":"-","/":"_","=":""};return t.replace(/[+/=]/g,e=>a[e])}function C(o){if(typeof o=="string"){const t={"-":"+",_:"/",".":"="},a=o.replace(/[-_.]/g,e=>t[e]);return X(a)}else return o}async function ee(o,t,a,e){let g={purpose:t},d=await U(`/auth/v1/users/${o}/webauthn/auth/start`,g);if(d.error)return console.error(d.error),{error:d.error.message||"Error starting the Authentication"};if(!d.body){let r="Did not receive a valid webauthn body";return console.error(r),{error:r}}let h=d.body,i=h.rcr;if(!i.publicKey){let r="no publicKey in challenge from the backend";return console.error(r),{error:r}}if(i.publicKey.challenge=C(i.publicKey.challenge),i.publicKey.allowCredentials)for(let r of i.publicKey.allowCredentials)r.id=C(r.id);const m=(h.exp-1)*1e3,b=new Date().getTime()+m;let s;try{const r=await Z(navigator.credentials.get(i),m);if(r)s=r;else return{error:a}}catch{return{error:new Date().getTime()>=b?e:a}}let y={code:h.code,data:{id:s.id,rawId:x(s.rawId),response:{authenticatorData:x(s.response.authenticatorData),clientDataJSON:x(s.response.clientDataJSON),signature:x(s.response.signature)},extensions:s.getClientExtensionResults(),type:s.type}},v=await U(`/auth/v1/users/${o}/webauthn/auth/finish`,y);return v.status===202?{data:v.body}:(console.error(v),{error:v.error?.message||"Authentication Error"})}var re=S('<div class="err svelte-jfkcym"> </div>'),te=S('<div class="good svelte-jfkcym"> </div>'),ae=S('<div class="wrapperOuter svelte-jfkcym"><div class="wrapperInner svelte-jfkcym"><div class="content svelte-jfkcym"><div class="contentRow svelte-jfkcym"><div class="contentHeader svelte-jfkcym"> </div></div> <div class="contentRow svelte-jfkcym"><div><!></div></div> <div class="contentRow svelte-jfkcym"><!></div></div></div></div>');function fe(o,t){N(t,!0);let a=$(),e=M(void 0);P(async()=>{H(e,await ee(t.userId,t.purpose,a.authorize.invalidKeyUsed,a.authorize.requestExpired),!0)}),G(()=>{l(e)&&(l(e).error?setTimeout(()=>{t.onError(l(e)?.error||"Webauthn Error")},3e3):t.onSuccess(l(e).data))});var g=K(),d=R(g);{var h=i=>{var m=ae(),b=n(m),s=n(b),y=n(s),v=n(y),r=n(v,!0);c(v),c(y);var w=z(y,2),A=n(w),O=n(A);{var W=u=>{V(u,{})};k(O,u=>{l(e)||u(W)})}c(A),c(w);var B=z(w,2),q=n(B);{var F=u=>{var E=K(),I=R(E);{var J=p=>{var f=re(),j=n(f,!0);c(f),D(()=>T(j,l(e).error)),_(p,f)},L=p=>{var f=te(),j=n(f,!0);c(f),D(()=>T(j,a.authorize.mfaAck)),_(p,f)};k(I,p=>{l(e).error?p(J):p(L,!1)})}_(u,E)};k(q,u=>{l(e)&&u(F)})}c(B),c(s),c(b),c(m),D(()=>T(r,a.authorize.expectingPasskey)),_(i,m)};k(d,i=>{t.purpose&&i(h)})}_(o,g),Q()}export{fe as W,ue as a,C as b};
