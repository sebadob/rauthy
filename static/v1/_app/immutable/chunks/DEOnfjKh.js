import{t as F,a as o,e as X,d as Ee}from"./DVyqXkF9.js";import{p as be,k as a,a2 as te,G as ze,a6 as ye,a as xe,f as ee,l as t,j as e,s as r,t as k,c as g,a5 as de,a4 as se,r as m,a1 as Qe,a7 as At}from"./DXTz3Rbt.js";import{s as w}from"./BLUcFBb0.js";import{i as U}from"./Dnzfvyee.js";import{e as qe,i as gt}from"./Dus-q-Em.js";import{b as _t,g as Xe,f as Pe,d as et}from"./DMieIo7a.js";import{O as Dt}from"./99krErCG.js";import{P as ct}from"./BLt68qL4.js";import{N as Ut}from"./x_khJbtH.js";import{B as Ft}from"./CVyulMm_.js";import{u as Ot}from"./21dMcSbF.js";import{N as Vt}from"./NPevBcaT.js";import{C as Mt}from"./CL_mTQmm.js";import{a as Te}from"./B28jQOFH.js";import{B as pe,t as pt,s as ht}from"./BaLU91-Z.js";import{I as fe}from"./DxMCa-Hz.js";import{b as Re,h as zt,i as mt,j as qt}from"./DzmDou2k.js";import{F as tt}from"./BkyS6Cp-.js";import{u as Ce}from"./pXVVLMtZ.js";import{u as Se}from"./T3uKKWzz.js";import{O as yt}from"./sqKkxQfp.js";import{I as Ve}from"./BSsA32Jj.js";import{I as Ze}from"./AGQ0LC6s.js";import{f as ke,a as Me,b as bt}from"./HguhFfd2.js";import{S as je}from"./C_k9S1mH.js";import{L as Ie}from"./BlWtnSFg.js";import{u as xt}from"./DFvlUuOi.js";import{T as Rt}from"./Uvg4PFWU.js";import{p as jt}from"./D54UoLP7.js";import{j as Ye,x as Bt}from"./Cx6cA6Ki.js";import{C as Gt}from"./CdgZ0Q70.js";import{I as Be}from"./COZs6rVX.js";import{U as wt,a as Ht,D as Kt}from"./BSs2SRZB.js";import{P as Wt}from"./DTccziEZ.js";import{I as ft}from"./BFELTQEF.js";import{h as Jt}from"./CP6_I6cz.js";import{P as Yt,f as Zt,a as Qt}from"./DEp-tmMd.js";var Xt=F("<div><!></div>"),er=F('<div class="err"> </div>'),tr=F("<!> <!> <!> <!> <!> <!> <!> <!> <div></div> <!> <!>",1),rr=F('<div class="container svelte-x7a3kj"><!></div>');function ar(ue,n){be(n,!0);let s=Ce(),v=Se(),d=a(void 0),_=a(""),E=a(""),T=a(""),I=a(""),q=de(()=>xt().common()?.map(f=>f)),H=a("en"),O=a(te(ze(()=>n.roles.map(f=>({name:f.name,selected:!1}))))),C=a(te(ze(()=>n.groups.map(f=>({name:f.name,selected:!1}))))),p=a(!1),$=a(te(ke())),P=a(te(Me()));ye(()=>{requestAnimationFrame(()=>{e(d)?.focus()})});async function B(f,A){t(_,"");let N={email:e(E),given_name:e(T),family_name:e(I)||void 0,language:e(H),groups:e(C).filter(R=>R.selected).map(R=>R.name),roles:e(O).filter(R=>R.selected).map(R=>R.name),user_expires:e(p)?bt(e($),e(P)):void 0};N.groups?.length===0&&(N.groups=void 0);let V=await _t(f.action,N);V.body?n.onSave(V.body.id):t(_,V.error?.message||"Error",!0)}var S=rr(),W=g(S);tt(W,{action:"/auth/v1/users",onSubmit:B,children:(f,A)=>{var N=tr(),V=ee(N);fe(V,{typ:"email",autocomplete:"off",label:"E-Mail",placeholder:"E-Mail",required:!0,get ref(){return e(d)},set ref(u){t(d,u,!0)},get value(){return e(E)},set value(u){t(E,u,!0)}});var R=r(V,2);fe(R,{autocomplete:"off",get label(){return s.account.givenName},get placeholder(){return s.account.givenName},required:!0,pattern:Re,get value(){return e(T)},set value(u){t(T,u,!0)}});var ie=r(R,2);fe(ie,{autocomplete:"off",get label(){return s.account.familyName},get placeholder(){return s.account.familyName},pattern:Re,get value(){return e(I)},set value(u){t(I,u,!0)}});var M=r(ie,2);{var G=u=>{Ie(u,{get label(){return v.common.language},children:(L,x)=>{yt(L,{get ariaLabel(){return s.common.selectI18n},get options(){return e(q)},borderless:!0,get value(){return e(H)},set value(Y){t(H,Y,!0)}})},$$slots:{default:!0}})};U(M,u=>{e(q)&&u(G)})}var re=r(M,2);je(re,{get items(){return e(O)},set items(u){t(O,u,!0)},children:(u,L)=>{se();var x=X();k(()=>w(x,s.account.roles)),o(u,x)},$$slots:{default:!0}});var K=r(re,2);je(K,{get items(){return e(C)},set items(u){t(C,u,!0)},children:(u,L)=>{se();var x=X();k(()=>w(x,s.account.groups)),o(u,x)},$$slots:{default:!0}});var J=r(K,2);Ve(J,{get ariaLabel(){return s.account.accessExp},get checked(){return e(p)},set checked(u){t(p,u,!0)},children:(u,L)=>{se();var x=X();k(()=>w(x,s.account.accessExp)),o(u,x)},$$slots:{default:!0}});var h=r(J,2);{var i=u=>{var L=Xt(),x=g(L);const Y=de(ke);Ze(x,{get label(){return s.account.accessExp},withTime:!0,get min(){return e(Y)},required:!0,get value(){return e($)},set value(le){t($,le,!0)},get timeValue(){return e(P)},set timeValue(le){t(P,le,!0)}}),m(L),pt(3,L,()=>ht,()=>({duration:150})),o(u,L)};U(h,u=>{e(p)&&u(i)})}var c=r(h,2);Te(c,"",{},{height:".66rem"});var y=r(c,2);pe(y,{type:"submit",children:(u,L)=>{se();var x=X();k(()=>w(x,s.common.save)),o(u,x)},$$slots:{default:!0}});var b=r(y,2);{var z=u=>{var L=er(),x=g(L,!0);m(L),k(()=>w(x,e(_))),o(u,L)};U(b,u=>{e(_)&&u(z)})}o(f,N)},$$slots:{default:!0}}),m(S),o(ue,S),xe()}var sr=F("<div><!></div>"),lr=F('<div class="svelte-126e0v0"><!></div>'),or=F('<div class="err"> </div>'),ur=F('<!> <div class="values svelte-126e0v0"><div class="svelte-126e0v0"><!></div> <div class="svelte-126e0v0"><!></div></div> <div class="values svelte-126e0v0"><div class="svelte-126e0v0"><!> <!> <!> <!> <!></div> <div class="svelte-126e0v0"><!> <!> <!> <!> <!></div></div> <!> <!> <div class="values svelte-126e0v0"><div class="svelte-126e0v0"><!></div> <!></div> <div class="values svelte-126e0v0"><div class="svelte-126e0v0"><!> <!></div> <div class="svelte-126e0v0"><!> <!></div></div> <div class="btn svelte-126e0v0"><!> <!></div> <!>',1),nr=F('<div class="picture svelte-126e0v0"><!></div> <!>',1);function ir(ue,n){be(n,!0);let s=jt(n,"user",15),v=Ce(),d=Se(),_=a(""),E=a(!1),T=a(""),I=a(""),q=a(""),H=de(()=>xt().common()?.map(h=>h)),O=a("en"),C=a(""),p=a(""),$=a(""),P=a(""),B=a(""),S=a(""),W=a(!1),f=a(!1),A=a(!1),N=a(te(ke())),V=a(te(Me())),R=a(te(ze(()=>n.roles.map(h=>({name:h.name,selected:!1}))))),ie=a(te(ze(()=>n.groups.map(h=>({name:h.name,selected:!1})))));ye(()=>{if(s()){if(t(T,s().email,!0),t(I,s().given_name,!0),t(q,s().family_name||"",!0),t(O,s().language,!0),t(C,s().user_values?.birthdate||"",!0),t(p,s().user_values?.phone||"",!0),t($,s().user_values?.street||"",!0),t(P,s().user_values?.zip?.toString()||"",!0),t(B,s().user_values?.city||"",!0),t(S,s().user_values?.country||"",!0),t(W,s().enabled,!0),t(f,s().email_verified,!0),s().user_expires){let h=new Date(s().user_expires*1e3);t(A,!0),t(N,ke(h),!0),t(V,Me(h),!0)}else t(A,!1),t(N,ke(),!0),t(V,Me(),!0);t(R,n.roles.map(h=>({name:h.name,selected:s()?.roles.includes(h.name)||!1})),!0),t(ie,n.groups.map(h=>({name:h.name,selected:s()?.groups?.includes(h.name)||!1})),!0)}});function M(h){let i=h.given_name[0];return h.family_name&&(i+=h.family_name[0]),i}async function G(h,i){t(_,"");const c={email:e(T),given_name:e(I),family_name:e(q)||void 0,language:e(O),roles:e(R).filter(b=>b.selected).map(b=>b.name),groups:e(ie).filter(b=>b.selected).map(b=>b.name),enabled:e(W),email_verified:e(f),user_expires:e(A)?bt(e(N),e(V)):void 0};(e(C)||e(p)||e($)||e(P)||e(B)||e(S))&&(c.user_values={birthdate:e(C)||void 0,phone:e(p)?.replaceAll(" ","")||void 0,street:e($)||void 0,zip:e(P)?Number.parseInt(e(P)):void 0,city:e(B)||void 0,country:e(S)||void 0});let y=await Xe(h.action,c);y.body?(t(E,!0),s(y.body),n.onSave(),setTimeout(()=>{t(E,!1)},3e3)):t(_,y.error?.message||"Error",!0)}var re=Ee(),K=ee(re);{var J=h=>{var i=nr(),c=ee(i),y=g(c);const b=de(()=>M(s()));wt(y,{get fallbackCharacters(){return e(b)},get userId(){return s().id},get pictureId(){return s().picture_id},size:"large"}),m(c);var z=r(c,2);const u=de(()=>`/auth/v1/users/${s().id}`);tt(z,{get action(){return e(u)},onSubmit:G,children:(L,x)=>{var Y=ur(),le=ee(Y);Ie(le,{label:"ID",mono:!0,children:(l,Q)=>{se();var D=X();k(()=>w(D,s().id)),o(l,D)},$$slots:{default:!0}});var j=r(le,2),Z=g(j),ve=g(Z);Ve(ve,{get ariaLabel(){return d.common.enabled},get checked(){return e(W)},set checked(l){t(W,l,!0)},children:(l,Q)=>{se();var D=X();k(()=>w(D,d.common.enabled)),o(l,D)},$$slots:{default:!0}}),m(Z);var ne=r(Z,2),ae=g(ne);Ve(ae,{get ariaLabel(){return v.account.emailVerified},get checked(){return e(f)},set checked(l){t(f,l,!0)},children:(l,Q)=>{se();var D=X();k(()=>w(D,v.account.emailVerified)),o(l,D)},$$slots:{default:!0}}),m(ne),m(j);var ce=r(j,2),$e=g(ce),Ne=g($e);fe(Ne,{typ:"email",autocomplete:"off",label:"E-Mail",placeholder:"E-Mail",required:!0,get value(){return e(T)},set value(l){t(T,l,!0)}});var Le=r(Ne,2);fe(Le,{autocomplete:"off",get label(){return v.account.givenName},get placeholder(){return v.account.givenName},required:!0,pattern:Re,get value(){return e(I)},set value(l){t(I,l,!0)}});var De=r(Le,2);fe(De,{autocomplete:"off",get label(){return v.account.familyName},get placeholder(){return v.account.familyName},pattern:Re,get value(){return e(q)},set value(l){t(q,l,!0)}});var Ue=r(De,2);Ze(Ue,{get label(){return v.account.birthdate},withDelete:!0,get value(){return e(C)},set value(l){t(C,l,!0)}});var oe=r(Ue,2);{var Fe=l=>{var Q=sr();Te(Q,"",{},{padding:".25rem"});var D=g(Q);Ie(D,{get label(){return d.common.language},children:(he,we)=>{yt(he,{get ariaLabel(){return v.common.selectI18n},get options(){return e(H)},borderless:!0,get value(){return e(O)},set value(Ae){t(O,Ae,!0)}})},$$slots:{default:!0}}),m(Q),o(l,Q)};U(oe,l=>{e(H)&&l(Fe)})}m($e);var ge=r($e,2),rt=g(ge);fe(rt,{autocomplete:"off",get label(){return v.account.street},get placeholder(){return v.account.street},pattern:zt,get value(){return e($)},set value(l){t($,l,!0)}});var at=r(rt,2);fe(at,{typ:"number",autocomplete:"off",get label(){return v.account.zip},get placeholder(){return v.account.zip},min:"1000",max:"9999999",get value(){return e(P)},set value(l){t(P,l,!0)}});var st=r(at,2);fe(st,{autocomplete:"off",get label(){return v.account.city},get placeholder(){return v.account.city},pattern:mt,get value(){return e(B)},set value(l){t(B,l,!0)}});var lt=r(st,2);fe(lt,{autocomplete:"off",get label(){return v.account.country},get placeholder(){return v.account.country},pattern:mt,get value(){return e(S)},set value(l){t(S,l,!0)}});var Pt=r(lt,2);fe(Pt,{autocomplete:"off",get label(){return v.account.phone},get placeholder(){return v.account.phone},pattern:qt,get value(){return e(p)},set value(l){t(p,l,!0)}}),m(ge),m(ce);var ot=r(ce,2);je(ot,{get items(){return e(R)},set items(l){t(R,l,!0)},children:(l,Q)=>{se();var D=X();k(()=>w(D,v.account.roles)),o(l,D)},$$slots:{default:!0}});var ut=r(ot,2);je(ut,{get items(){return e(ie)},set items(l){t(ie,l,!0)},children:(l,Q)=>{se();var D=X();k(()=>w(D,v.account.groups)),o(l,D)},$$slots:{default:!0}});var Ge=r(ut,2),Oe=g(Ge);Te(Oe,"",{},{"margin-top":".5rem"});var St=g(Oe);Ve(St,{get ariaLabel(){return v.account.accessExp},get checked(){return e(A)},set checked(l){t(A,l,!0)},children:(l,Q)=>{se();var D=X();k(()=>w(D,v.account.accessExp)),o(l,D)},$$slots:{default:!0}}),m(Oe);var It=r(Oe,2);{var $t=l=>{var Q=lr(),D=g(Q);const he=de(ke);Ze(D,{get label(){return v.account.accessExp},withTime:!0,get min(){return e(he)},required:!0,get value(){return e(N)},set value(we){t(N,we,!0)},get timeValue(){return e(V)},set timeValue(we){t(V,we,!0)}}),m(Q),pt(3,Q,()=>ht,()=>({duration:150})),o(l,Q)};U(It,l=>{e(A)&&l($t)})}m(Ge);var He=r(Ge,2),Ke=g(He),nt=g(Ke);Ie(nt,{get label(){return v.account.userCreated},children:(l,Q)=>{se();var D=X();k(he=>w(D,he),[()=>Ye(s().created_at)]),o(l,D)},$$slots:{default:!0}});var kt=r(nt,2);Ie(kt,{get label(){return d.users.lastLogin},children:(l,Q)=>{var D=Ee(),he=ee(D);{var we=me=>{var _e=X();k(Je=>w(_e,Je),[()=>Ye(s().last_login)]),o(me,_e)},Ae=me=>{var _e=X();k(()=>w(_e,v.common.never)),o(me,_e)};U(he,me=>{s().last_login?me(we):me(Ae,!1)})}o(l,D)},$$slots:{default:!0}}),m(Ke);var it=r(Ke,2),vt=g(it);Ie(vt,{get label(){return v.account.passwordExpiry},children:(l,Q)=>{var D=Ee(),he=ee(D);{var we=me=>{var _e=X();k(Je=>w(_e,Je),[()=>Ye(s().password_expires)]),o(me,_e)},Ae=me=>{var _e=X();k(()=>w(_e,v.common.never)),o(me,_e)};U(he,me=>{s().password_expires?me(we):me(Ae,!1)})}o(l,D)},$$slots:{default:!0}});var Et=r(vt,2);Ie(Et,{get label(){return v.account.mfaActivated},children:(l,Q)=>{const D=de(()=>!!s().webauthn_user_id);Gt(l,{get checked(){return e(D)}})},$$slots:{default:!0}}),m(it),m(He);var We=r(He,2),dt=g(We);pe(dt,{type:"submit",children:(l,Q)=>{se();var D=X();k(()=>w(D,v.common.save)),o(l,D)},$$slots:{default:!0}});var Tt=r(dt,2);{var Ct=l=>{Be(l,{})};U(Tt,l=>{e(E)&&l(Ct)})}m(We);var Nt=r(We,2);{var Lt=l=>{var Q=or(),D=g(Q,!0);m(Q),k(()=>w(D,e(_))),o(l,Q)};U(Nt,l=>{e(_)&&l(Lt)})}o(L,Y)},$$slots:{default:!0}}),o(h,i)};U(K,h=>{s()&&h(J)})}o(ue,re),xe()}var vr=F("<p> </p>"),dr=F('<p> </p> <!> <div class="flex gap-05"><!> <!></div>',1),cr=F('<div class="err"> </div>'),mr=F('<div class="container svelte-b4h84n"><!></div> <!>',1);function fr(ue,n){be(n,!0);let s=Ce(),v=Se(),d=a(""),_=a(!1),E=a(te([])),T=a(te([])),I=a(te([]));Qe(()=>{q()}),ye(()=>{H()}),ye(()=>{t(I,e(E).map(f=>({name:f.name,desc:f.desc,value:e(T).find(N=>N.key===f.name)?.value||""})),!0)});async function q(){let f=await Pe("/auth/v1/users/attr");f.body?t(E,f.body.values.toSorted((A,N)=>A.name.localeCompare(N.name)),!0):t(d,f.error?.message||"Error fetching attrs",!0)}async function H(){let f=await Pe(`/auth/v1/users/${n.user.id}/attr`);f.body?t(T,f.body.values,!0):t(d,f.error?.message||"Error fetching users attrs",!0)}async function O(){t(d,"");let f=e(T).map(V=>V.key),A={values:e(I).filter(V=>V.value.trim()||f.includes(V.name)).map(V=>({key:V.name,value:V.value.trim()}))},N=await Xe(`/auth/v1/users/${n.user.id}/attr`,A);N.error?t(d,N.error.message,!0):(t(_,!0),setTimeout(()=>{t(_,!1)},3e3)),n.onSave()}var C=mr(),p=ee(C),$=g(p);{var P=f=>{var A=vr(),N=g(A,!0);m(A),k(()=>w(N,v.common.noEntries)),o(f,A)},B=f=>{var A=dr(),N=ee(A),V=g(N,!0);m(N);var R=r(N,2);qe(R,17,()=>e(I),gt,(K,J,h)=>{const i=de(()=>e(J).desc||"JSON Value");fe(K,{autocomplete:"off",get label(){return e(J).name},get placeholder(){return e(i)},get value(){return e(J).value},set value(c){e(J).value=c}})});var ie=r(R,2),M=g(ie);pe(M,{onclick:O,children:(K,J)=>{se();var h=X();k(()=>w(h,s.common.save)),o(K,h)},$$slots:{default:!0}});var G=r(M,2);{var re=K=>{Be(K,{})};U(G,K=>{e(_)&&K(re)})}m(ie),k(()=>w(V,v.users.descAttr)),o(f,A)};U($,f=>{e(I).length===0?f(P):f(B,!1)})}m(p);var S=r(p,2);{var W=f=>{var A=cr(),N=g(A,!0);m(A),k(()=>w(N,e(d))),o(f,A)};U(S,f=>{e(d)&&f(W)})}o(ue,C),xe()}var gr=F("<p><b> </b></p> <p> </p> <!> <p> </p> <!>",1),_r=F('<div class="desc"><p><b> </b></p> <p> </p> <p> </p></div>'),pr=F('<!> <!> <!> <div></div> <p> </p> <div class="flex gap-05"><!> <!> <!></div>',1),hr=F("<div></div> <!> <!>",1),yr=F('<div class="err"> </div>'),br=F("<!> <!>",1);function xr(ue,n){be(n,!0);const s="min(20rem, calc(100dvw - .5rem))";let v=Ce(),d=Se(),_=a(!1),E=a(""),T=a(!1),I=a(void 0),q=a(!1),H=a(!1),O=a(""),C=a(""),p=de(()=>e(O).length>(e(I)?.length_min||8)&&e(O)===e(C)),$=a(void 0),P=a(void 0);Qe(async()=>{let M=await Pe("/auth/v1/password_policy");M.body?t(I,M.body,!0):t(E,M.error?.message||"Error",!0)}),ye(()=>{n.user.id&&(t(O,""),t(C,""),t(H,!1))});async function B(){t(E,""),t(_,!0);let M={email:n.user.email},G=await _t("/auth/v1/users/request_reset",M);G.error?t(E,G.error.message,!0):(t(T,!0),setTimeout(()=>{t(T,!1)},3e3)),t(_,!1)}async function S(M,G){if(!e(q)){t(E,v.account.passwordPolicyFollow,!0);return}if(e(O)!==e(C)){t(E,v.account.passwordNoMatch,!0);return}let re={email:n.user.email,given_name:n.user.given_name,family_name:n.user.family_name,language:n.user.language,password:e(O),roles:n.user.roles,groups:n.user.groups,enabled:n.user.enabled,email_verified:n.user.email_verified,user_expires:n.user.user_expires};t(E,""),t(_,!0);let K=await Xe(M.action,re);K.error?t(E,K.error.message,!0):(t(T,!0),setTimeout(()=>{t(T,!1),n.onSave()},3e3)),t(_,!1)}function W(){if(t(E,""),!e(I))return;let M=Bt(e(I));t(O,M,!0),t(C,M,!0),requestAnimationFrame(()=>{e($)?.(),e(P)?.()})}var f=br(),A=ee(f);{var N=M=>{var G=gr(),re=ee(G),K=g(re),J=g(K,!0);m(K),m(re);var h=r(re,2),i=g(h,!0);m(h);var c=r(h,2);pe(c,{onclick:B,get isLoading(){return e(_)},children:(u,L)=>{se();var x=X();k(()=>w(x,d.users.pwdSendEmailBtn)),o(u,x)},$$slots:{default:!0}});var y=r(c,2);Te(y,"",{},{"margin-top":"1rem"});var b=g(y,!0);m(y);var z=r(y,2);pe(z,{level:2,onclick:()=>t(H,!0),children:(u,L)=>{se();var x=X();k(()=>w(x,d.users.manualInit)),o(u,x)},$$slots:{default:!0}}),k(()=>{w(J,d.users.pwdNoInit),w(i,d.users.pwdSendEmailDesc),w(b,d.users.manualInitDesc)}),o(M,G)},V=(M,G)=>{{var re=J=>{var h=_r(),i=g(h),c=g(i),y=g(c,!0);m(c),m(i);var b=r(i,2),z=g(b,!0);m(b);var u=r(b,2),L=g(u,!0);m(u),m(h),k(()=>{w(y,d.users.pkOnly1),w(z,d.users.pkOnly2),w(L,d.users.pkOnly3)}),o(J,h)},K=J=>{var h=hr(),i=ee(h);Te(i,"",{},{"margin-top":".5rem"});var c=r(i,2);{var y=u=>{Wt(u,{get password(){return e(O)},get policy(){return e(I)},get accepted(){return e(q)},set accepted(L){t(q,L,!0)}})};U(c,u=>{e(I)&&u(y)})}var b=r(c,2);const z=de(()=>`/auth/v1/users/${n.user.id}`);tt(b,{get action(){return e(z)},onSubmit:S,children:(u,L)=>{var x=pr(),Y=ee(x);const le=de(()=>e(I)?.length_max||256);ft(Y,{autocomplete:"off",get label(){return v.account.passwordNew},get placeholder(){return v.account.passwordNew},get showCopy(){return e(p)},required:!0,get maxLength(){return e(le)},width:s,get value(){return e(O)},set value(oe){t(O,oe,!0)},get reportValidity(){return e($)},set reportValidity(oe){t($,oe,!0)}});var j=r(Y,2);const Z=de(()=>e(I)?.length_max||256);ft(j,{autocomplete:"off",get label(){return v.account.passwordConfirm},get placeholder(){return v.account.passwordConfirm},required:!0,get maxLength(){return e(Z)},width:s,get value(){return e(C)},set value(oe){t(C,oe,!0)},get reportValidity(){return e(P)},set reportValidity(oe){t(P,oe,!0)}});var ve=r(j,2);pe(ve,{level:2,onclick:W,children:(oe,Fe)=>{se();var ge=X();k(()=>w(ge,v.account.generateRandom)),o(oe,ge)},$$slots:{default:!0}});var ne=r(ve,2);Te(ne,"",{},{"margin-top":"1rem"});var ae=r(ne,2),ce=g(ae,!0);m(ae);var $e=r(ae,2),Ne=g($e);pe(Ne,{onclick:B,get isLoading(){return e(_)},children:(oe,Fe)=>{se();var ge=X();k(()=>w(ge,d.users.sendResetEmail)),o(oe,ge)},$$slots:{default:!0}});var Le=r(Ne,2);pe(Le,{type:"submit",level:2,get isLoading(){return e(_)},children:(oe,Fe)=>{se();var ge=X();k(()=>w(ge,d.users.savePassword)),o(oe,ge)},$$slots:{default:!0}});var De=r(Le,2);{var Ue=oe=>{Be(oe,{})};U(De,oe=>{e(T)&&oe(Ue)})}m($e),k(()=>w(ce,d.users.selfServiceDesc)),o(u,x)},$$slots:{default:!0}}),o(J,h)};U(M,J=>{n.user.account_type==="passkey"||n.user.account_type==="federated_passkey"?J(re):J(K,!1)},G)}};U(A,M=>{n.user.account_type==="new"&&!e(H)?M(N):M(V,!1)})}var R=r(A,2);{var ie=M=>{var G=yr(),re=g(G,!0);m(G),k(()=>w(re,e(E))),o(M,G)};U(R,M=>{e(E)&&M(ie)})}o(ue,f),xe()}var wr=F("<p> </p>"),Pr=F('<p> </p> <p><!></p> <div class="keysContainer svelte-1teaezc"></div>',1),Sr=F('<div class="err"> </div>'),Ir=F("<!> <!>",1);function $r(ue,n){be(n,!0);let s=Se(),v=a(""),d=a(te([]));ye(()=>{_()});async function _(){let p=await Pe(`/auth/v1/users/${n.user.id}/webauthn`);p.body?t(d,p.body,!0):t(v,p.error?.message||"Error",!0)}async function E(p){let $=e(d).length===1,P=await et(`/auth/v1/users/${n.user.id}/webauthn/delete/${p}`);P.status===200?(await _(),$&&n.onSave()):t(v,P.error?.message||"Error",!0)}var T=Ir(),I=ee(T);{var q=p=>{var $=wr(),P=g($,!0);m($),k(()=>w(P,s.users.noMfaKeys)),o(p,$)},H=p=>{var $=Pr(),P=ee($),B=g(P,!0);m(P);var S=r(P,2),W=g(S);Jt(W,()=>s.users.mfaDelete2),m(S);var f=r(S,2);qe(f,21,()=>e(d),A=>A.name,(A,N)=>{Ht(A,{get passkey(){return e(N)},showDelete:!0,onDelete:E})}),m(f),k(()=>w(B,s.users.mfaDelete1)),o(p,$)};U(I,p=>{e(d).length===0?p(q):p(H,!1)})}var O=r(I,2);{var C=p=>{var $=Sr(),P=g($,!0);m($),k(()=>w(P,e(v))),o(p,$)};U(O,p=>{e(v)&&p(C)})}o(ue,T),xe()}var kr=F('<div class="err"> </div>'),Er=F('<p> </p> <div class="flex gap-05"><!> <!></div> <!>',1);function Tr(ue,n){be(n,!0);let s=Se(),v=a(""),d=a(!1);async function _(){t(v,"");let P=await et(`/auth/v1/sessions/${n.userId}`);P.error?t(v,P.error.message,!0):(t(d,!0),setTimeout(()=>{t(d,!1)},3e3))}var E=Er(),T=ee(E),I=g(T,!0);m(T);var q=r(T,2),H=g(q);pe(H,{level:-1,onclick:_,children:(P,B)=>{se();var S=X("Logout");o(P,S)},$$slots:{default:!0}});var O=r(H,2);{var C=P=>{Be(P,{})};U(O,P=>{e(d)&&P(C)})}m(q);var p=r(q,2);{var $=P=>{var B=kr(),S=g(B,!0);m(B),k(()=>w(S,e(v))),o(P,B)};U(p,P=>{e(v)&&P($)})}k(()=>w(I,s.users.forceLogout)),o(ue,E),xe()}var Cr=F('<div class="err"> </div>'),Nr=F("<p> </p> <!> <!>",1);function Lr(ue,n){be(n,!0);let s=Ce(),v=Se(),d=a("");async function _(){t(d,"");let C=await et(`/auth/v1/users/${n.userId}`);C.error?t(d,C.error.message,!0):n.onSave()}var E=Nr(),T=ee(E),I=g(T,!0);m(T);var q=r(T,2);pe(q,{level:-1,onclick:_,children:(C,p)=>{se();var $=X();k(()=>w($,s.common.delete)),o(C,$)},$$slots:{default:!0}});var H=r(q,2);{var O=C=>{var p=Cr(),$=g(p,!0);m(p),k(()=>w($,e(d))),o(C,p)};U(H,C=>{e(d)&&C(O)})}k(()=>w(I,v.users.deleteUser)),o(ue,E),xe()}var Ar=F('<div class="err"> </div>'),Dr=F('<!> <div class="flex"><!></div> <!>',1);function Ur(ue,n){be(n,!0);let s=Ce(),v=Se();const d=[s.account.navInfo,v.users.attributes,s.common.password,s.account.navMfa,s.account.devices,s.account.navLogout,s.common.delete];let _=a(te(d[0])),E=a(void 0),T=a(""),I=a(void 0);ye(()=>{q()});async function q(){let S=await Pe(`/auth/v1/users/${n.userId}`);S.body?(t(I,S.body,!0),requestAnimationFrame(()=>{e(E)?.()})):t(T,S.error?.message||"Error fetching user",!0)}var H=Dr(),O=ee(H);{var C=S=>{var W=Ar(),f=g(W,!0);m(W),k(()=>w(f,e(T))),o(S,W)};U(O,S=>{e(T)&&S(C)})}var p=r(O,2),$=g(p);Rt($,{tabs:d,get selected(){return e(_)},set selected(S){t(_,S,!0)},get focusFirst(){return e(E)},set focusFirst(S){t(E,S,!0)}}),m(p);var P=r(p,2);{var B=S=>{var W=Ee(),f=ee(W);{var A=V=>{ir(V,{get roles(){return n.roles},get groups(){return n.groups},get onSave(){return n.onSave},get user(){return e(I)},set user(R){t(I,R,!0)}})},N=(V,R)=>{{var ie=G=>{fr(G,{get user(){return e(I)},get onSave(){return n.onSave}})},M=(G,re)=>{{var K=h=>{xr(h,{get user(){return e(I)},get onSave(){return n.onSave}})},J=(h,i)=>{{var c=b=>{$r(b,{get user(){return e(I)},get onSave(){return n.onSave}})},y=(b,z)=>{{var u=x=>{Kt(x,{get userId(){return n.userId}})},L=(x,Y)=>{{var le=Z=>{Tr(Z,{get userId(){return n.userId}})},j=(Z,ve)=>{{var ne=ae=>{Lr(ae,{get userId(){return n.userId},get onSave(){return n.onSave}})};U(Z,ae=>{e(_)===d[6]&&ae(ne)},ve)}};U(x,Z=>{e(_)===d[5]?Z(le):Z(j,!1)},Y)}};U(b,x=>{e(_)===d[4]?x(u):x(L,!1)},z)}};U(h,b=>{e(_)===d[3]?b(c):b(y,!1)},i)}};U(G,h=>{e(_)===d[2]?h(K):h(J,!1)},re)}};U(V,G=>{e(_)===d[1]?G(ie):G(M,!1)},R)}};U(f,V=>{e(_)===d[0]?V(A):V(N,!1)})}o(S,W)};U(P,S=>{e(I)&&S(B)})}o(ue,H),xe()}var Fr=F('<div class="navBtn svelte-1j85uvt"><div class="picture"><!></div> <div class="tile svelte-1j85uvt"><div> </div> <div class="muted svelte-1j85uvt"> </div></div></div>'),Or=F('<div class="usersList svelte-1j85uvt"><!></div> <!>',1),Vr=F("<!> <!>",1),Mr=F('<div class="err"> </div>'),zr=F('<!> <div id="users"><!></div>',1),qr=F("<!> <!>",1);function Ia(ue,n){be(n,!0);const s=(i,c=At)=>{const y=de(()=>I.get()===c().id);Vt(i,{onclick:()=>I.set(c().id),get selected(){return e(y)},pictureLeft:!0,children:(b,z)=>{var u=Fr(),L=g(u),x=g(L);const Y=de(()=>ie(c()));wt(x,{get fallbackCharacters(){return e(Y)},get userId(){return c().id},get pictureId(){return c().picture_id},size:"small",disableUpload:!0}),m(L);var le=r(L,2),j=g(le),Z=g(j,!0);m(j);var ve=r(j,2),ne=g(ve);m(ve),m(le),m(u),k(()=>{w(Z,c().email),w(ne,`${c().given_name??""}
                    ${c().family_name??""}`)}),o(b,u)}})};let v=a(void 0),d=a(""),_=a(te([])),E=a(te([])),T=a(te([])),I=Ot("uid"),q=a(void 0),H=a(te([])),O=a(te([])),C=a(!1),p=a(void 0),$=a(te(Yt)),P=a(!1),B=te(["E-Mail","ID"]),S=a(te(B[0])),W=a(""),f=te(["E-Mail","ID","Created","Last Login"]);Qe(()=>{N("page_size="+e($)),V(),R()}),ye(()=>{t(q,e(_).find(i=>i.id===I.get())?.id,!0)}),ye(()=>{let i=e(W).toLowerCase();e(C)?i.length<3?e(P)&&(N("page_size="+e($)),t(P,!1)):A(i):i?e(S)===B[0]?t(E,e(_).filter(c=>c.email?.toLowerCase().includes(i)),!0):e(S)===B[1]&&t(E,e(_).filter(c=>c.id.toLowerCase().includes(i)),!0):t(E,e(_),!0)});async function A(i){t(p,void 0),t(P,!0);let c;e(S)===B[0]?c="email":c="id";let y=await Zt({ty:"user",idx:c,q:i});y.body?t(_,y.body,!0):console.error(y.error)}async function N(i){let c="/auth/v1/users";i&&(c+=`?${i}`);let y=await Pe(c);return y.error?t(d,"Error fetching users: "+y.error.message):y.body&&(y.status===206?(t(C,!0),t(p,y.headers,!0)):(t(C,!1),t(p,void 0)),t(_,y.body,!0)),[y.status,y.headers]}async function V(){let i=await Pe("/auth/v1/roles");i.body?t(O,i.body.toSorted((c,y)=>c.name.localeCompare(y.name)),!0):t(d,i.error?.message||"Error",!0)}async function R(){let i=await Pe("/auth/v1/groups");i.body?t(H,i.body.toSorted((c,y)=>c.name.localeCompare(y.name)),!0):t(d,i.error?.message||"Error",!0)}function ie(i){let c=i.given_name[0];return i.family_name&&(c+=i.family_name[0]),c}function M(i,c){let y=c==="up";i===f[0]?e(_).sort((b,z)=>y?b.email.localeCompare(z.email):z.email.localeCompare(b.email)):i===f[1]?e(_).sort((b,z)=>y?b.id.localeCompare(z.id):z.id.localeCompare(b.id)):i===f[2]?e(_).sort((b,z)=>y?b.created_at-z.created_at:z.created_at-b.created_at):i===f[3]&&e(_).sort((b,z)=>{let u=b.last_login||9999999999,L=b.last_login||9999999999;return y?u-L:L-u})}async function G(i){e(v)?.(),await N(),I.set(i)}function re(){N(),V(),R(),t(W,"")}var K=qr(),J=ee(K);Ut(J,{paddingTop:"2.1rem",buttonTilesAriaControls:"users",width:"min(23rem, 100dvw)",thresholdNavSub:700,buttonTiles:c=>{var y=Or(),b=ee(y),z=g(b);{var u=j=>{var Z=Ee(),ve=ee(Z);qe(ve,17,()=>e(_),gt,(ne,ae)=>{s(ne,()=>e(ae))}),o(j,Z)},L=j=>{var Z=Ee(),ve=ee(Z);qe(ve,17,()=>e(T),ne=>ne.id,(ne,ae)=>{s(ne,()=>e(ae))}),o(j,Z)};U(z,j=>{e(p)?j(u):j(L,!1)})}m(b);var x=r(b,2);{var Y=j=>{Qt(j,{sspFetch:N,idxTotalCount:"x-user-count",get itemsLength(){return e(_).length},get firstFetchHeaders(){return e(p)},get pageSize(){return e($)},set pageSize(Z){t($,Z,!0)}})},le=(j,Z)=>{{var ve=ae=>{ct(ae,{get items(){return e(_)},set items(ce){t(_,ce,!0)},get itemsPaginated(){return e(T)},set itemsPaginated(ce){t(T,ce,!0)}})},ne=ae=>{ct(ae,{get items(){return e(E)},set items(ce){t(E,ce,!0)},get itemsPaginated(){return e(T)},set itemsPaginated(ce){t(T,ce,!0)}})};U(j,ae=>{e(C)?ae(ve):ae(ne,!1)},Z)}};U(x,j=>{e(p)?j(Y):j(le,!1)})}o(c,y)},children:(c,y)=>{var b=Vr(),z=ee(b);const u=de(()=>e(O).length===0?1:2);Ft(z,{get level(){return e(u)},alignRight:!0,get closeModal(){return e(v)},set closeModal(x){t(v,x,!0)},children:(x,Y)=>{ar(x,{onSave:G,get roles(){return e(O)},get groups(){return e(H)}})},$$slots:{default:!0}});var L=r(z,2);Dt(L,{get searchOptions(){return B},get orderOptions(){return f},onChangeOrder:M,searchWidth:"min(23rem, calc(100dvw - .5rem))",get value(){return e(W)},set value(x){t(W,x,!0)},get searchOption(){return e(S)},set searchOption(x){t(S,x,!0)}}),o(c,b)},$$slots:{buttonTiles:!0,default:!0}});var h=r(J,2);Mt(h,{children:(i,c)=>{var y=zr(),b=ee(y);{var z=Y=>{var le=Mr(),j=g(le,!0);m(le),k(()=>w(j,e(d))),o(Y,le)};U(b,Y=>{e(d)&&Y(z)})}var u=r(b,2),L=g(u);{var x=Y=>{Ur(Y,{get userId(){return e(q)},get roles(){return e(O)},get groups(){return e(H)},onSave:re})};U(L,Y=>{e(q)&&Y(x)})}m(u),o(i,y)}}),o(ue,K),xe()}export{Ia as U};
